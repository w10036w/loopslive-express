!function(){var e={},t={},n={},o={},i={},r={},a={},s={},u={},l={},c={},d={},f={},h={},p={},v={},m={},g={},w={},y={},b={},C={},x={},k={},T={},E={},S={},N={},M={},A={},R={},D={},O={},I={},j={},L={},P={},_={},q={},V={},H={},B={},F={},U={},z={},G={},J={},W={},Y={},X={},Z={},Q={};!function(){e=function(e){var t=function(){function e(e){return null==e?String(e):G[J.call(e)]||"object"}function t(t){return"function"==e(t)}function n(e){return null!=e&&e==e.window}function o(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE}function i(t){return"object"==e(t)}function r(e){return i(e)&&!n(e)&&Object.getPrototypeOf(e)==Object.prototype}function a(e){return"number"==typeof e.length}function s(e){return A.call(e,function(e){return null!=e})}function u(e){return e.length>0?k.fn.concat.apply([],e):e}function l(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function c(e){return e in O?O[e]:O[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function d(e,t){return"number"!=typeof t||I[l(e)]?t:t+"px"}function f(e){var t,n;return D[e]||(t=R.createElement(e),R.body.appendChild(t),n=getComputedStyle(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),"none"==n&&(n="block"),D[e]=n),D[e]}function h(e){return"children"in e?M.call(e.children):k.map(e.childNodes,function(e){return 1==e.nodeType?e:void 0})}function p(e,t,n){for(x in t)n&&(r(t[x])||Z(t[x]))?(r(t[x])&&!r(e[x])&&(e[x]={}),Z(t[x])&&!Z(e[x])&&(e[x]=[]),p(e[x],t[x],n)):t[x]!==C&&(e[x]=t[x])}function v(e,t){return null==t?k(e):k(e).filter(t)}function m(e,n,o,i){return t(n)?n.call(e,o,i):n}function g(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function w(e,t){var n=e.className||"",o=n&&n.baseVal!==C;return t===C?o?n.baseVal:n:void(o?n.baseVal=t:e.className=t)}function y(e){try{return e?"true"==e||("false"==e?!1:"null"==e?null:+e+""==e?+e:/^[\[\{]/.test(e)?k.parseJSON(e):e):e}catch(t){return e}}function b(e,t){t(e);for(var n=0,o=e.childNodes.length;o>n;n++)b(e.childNodes[n],t)}var C,x,k,T,E,S,N=[],M=N.slice,A=N.filter,R=window.document,D={},O={},I={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},j=/^\s*<(\w+|!)[^>]*>/,L=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,P=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,_=/^(?:body|html)$/i,q=/([A-Z])/g,V=["val","css","html","text","data","width","height","offset"],H=["after","prepend","before","append"],B=R.createElement("table"),F=R.createElement("tr"),$={tr:R.createElement("tbody"),tbody:B,thead:B,tfoot:B,td:F,th:F,"*":R.createElement("div")},U=/complete|loaded|interactive/,z=/^[\w-]*$/,G={},J=G.toString,W={},Y=R.createElement("div"),X={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},Z=Array.isArray||function(e){return e instanceof Array};return W.matches=function(e,t){if(!t||!e||1!==e.nodeType)return!1;var n=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var o,i=e.parentNode,r=!i;return r&&(i=Y).appendChild(e),o=~W.qsa(i,t).indexOf(e),r&&Y.removeChild(e),o},E=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},S=function(e){return A.call(e,function(t,n){return e.indexOf(t)==n})},W.fragment=function(e,t,n){var o,i,a;return L.test(e)&&(o=k(R.createElement(RegExp.$1))),o||(e.replace&&(e=e.replace(P,"<$1></$2>")),t===C&&(t=j.test(e)&&RegExp.$1),t in $||(t="*"),a=$[t],a.innerHTML=""+e,o=k.each(M.call(a.childNodes),function(){a.removeChild(this)})),r(n)&&(i=k(o),k.each(n,function(e,t){V.indexOf(e)>-1?i[e](t):i.attr(e,t)})),o},W.Z=function(e,t){return e=e||[],e.__proto__=k.fn,e.selector=t||"",e},W.isZ=function(e){return e instanceof W.Z},W.init=function(e,n){var o;if(!e)return W.Z();if("string"==typeof e)if(e=e.trim(),"<"==e[0]&&j.test(e))o=W.fragment(e,RegExp.$1,n),e=null;else{if(n!==C)return k(n).find(e);o=W.qsa(R,e)}else{if(t(e))return k(R).ready(e);if(W.isZ(e))return e;if(Z(e))o=s(e);else if(i(e))o=[e],e=null;else if(j.test(e))o=W.fragment(e.trim(),RegExp.$1,n),e=null;else{if(n!==C)return k(n).find(e);o=W.qsa(R,e)}}return W.Z(o,e)},k=function(e,t){return W.init(e,t)},k.extend=function(e){var t,n=M.call(arguments,1);return"boolean"==typeof e&&(t=e,e=n.shift()),n.forEach(function(n){p(e,n,t)}),e},W.qsa=function(e,t){var n,i="#"==t[0],r=!i&&"."==t[0],a=i||r?t.slice(1):t,s=z.test(a);return o(e)&&s&&i?(n=e.getElementById(a))?[n]:[]:1!==e.nodeType&&9!==e.nodeType?[]:M.call(s&&!i?r?e.getElementsByClassName(a):e.getElementsByTagName(t):e.querySelectorAll(t))},k.contains=R.documentElement.contains?function(e,t){return e!==t&&e.contains(t)}:function(e,t){for(;t&&(t=t.parentNode);)if(t===e)return!0;return!1},k.type=e,k.isFunction=t,k.isWindow=n,k.isArray=Z,k.isPlainObject=r,k.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},k.inArray=function(e,t,n){return N.indexOf.call(t,e,n)},k.camelCase=E,k.trim=function(e){return null==e?"":String.prototype.trim.call(e)},k.uuid=0,k.support={},k.expr={},k.map=function(e,t){var n,o,i,r=[];if(a(e))for(o=0;o<e.length;o++)n=t(e[o],o),null!=n&&r.push(n);else for(i in e)n=t(e[i],i),null!=n&&r.push(n);return u(r)},k.each=function(e,t){var n,o;if(a(e)){for(n=0;n<e.length;n++)if(t.call(e[n],n,e[n])===!1)return e}else for(o in e)if(t.call(e[o],o,e[o])===!1)return e;return e},k.grep=function(e,t){return A.call(e,t)},window.JSON&&(k.parseJSON=JSON.parse),k.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){G["[object "+t+"]"]=t.toLowerCase()}),k.fn={forEach:N.forEach,reduce:N.reduce,push:N.push,sort:N.sort,indexOf:N.indexOf,concat:N.concat,map:function(e){return k(k.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return k(M.apply(this,arguments))},ready:function(e){return U.test(R.readyState)&&R.body?e(k):R.addEventListener("DOMContentLoaded",function(){e(k)},!1),this},get:function(e){return e===C?M.call(this):this[e>=0?e:e+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(e){return N.every.call(this,function(t,n){return e.call(t,n,t)!==!1}),this},filter:function(e){return t(e)?this.not(this.not(e)):k(A.call(this,function(t){return W.matches(t,e)}))},add:function(e,t){return k(S(this.concat(k(e,t))))},is:function(e){return this.length>0&&W.matches(this[0],e)},not:function(e){var n=[];if(t(e)&&e.call!==C)this.each(function(t){e.call(this,t)||n.push(this)});else{var o="string"==typeof e?this.filter(e):a(e)&&t(e.item)?M.call(e):k(e);this.forEach(function(e){o.indexOf(e)<0&&n.push(e)})}return k(n)},has:function(e){return this.filter(function(){return i(e)?k.contains(this,e):k(this).find(e).size()})},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!i(e)?e:k(e)},last:function(){var e=this[this.length-1];return e&&!i(e)?e:k(e)},find:function(e){var t,n=this;return t=e?"object"==typeof e?k(e).filter(function(){var e=this;return N.some.call(n,function(t){return k.contains(t,e)})}):1==this.length?k(W.qsa(this[0],e)):this.map(function(){return W.qsa(this,e)}):k()},closest:function(e,t){var n=this[0],i=!1;for("object"==typeof e&&(i=k(e));n&&!(i?i.indexOf(n)>=0:W.matches(n,e));)n=n!==t&&!o(n)&&n.parentNode;return k(n)},parents:function(e){for(var t=[],n=this;n.length>0;)n=k.map(n,function(e){return(e=e.parentNode)&&!o(e)&&t.indexOf(e)<0?(t.push(e),e):void 0});return v(t,e)},parent:function(e){return v(S(this.pluck("parentNode")),e)},children:function(e){return v(this.map(function(){return h(this)}),e)},contents:function(){return this.map(function(){return M.call(this.childNodes)})},siblings:function(e){return v(this.map(function(e,t){return A.call(h(t.parentNode),function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return k.map(this,function(t){return t[e]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=f(this.nodeName))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var n=t(e);if(this[0]&&!n)var o=k(e).get(0),i=o.parentNode||this.length>1;return this.each(function(t){k(this).wrapAll(n?e.call(this,t):i?o.cloneNode(!0):o)})},wrapAll:function(e){if(this[0]){k(this[0]).before(e=k(e));for(var t;(t=e.children()).length;)e=t.first();k(e).append(this)}return this},wrapInner:function(e){var n=t(e);return this.each(function(t){var o=k(this),i=o.contents(),r=n?e.call(this,t):e;i.length?i.wrapAll(r):o.append(r)})},unwrap:function(){return this.parent().each(function(){k(this).replaceWith(k(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(e){return this.each(function(){var t=k(this);(e===C?"none"==t.css("display"):e)?t.show():t.hide()})},prev:function(e){return k(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return k(this.pluck("nextElementSibling")).filter(e||"*")},html:function(e){return 0 in arguments?this.each(function(t){var n=this.innerHTML;k(this).empty().append(m(this,e,t,n))}):0 in this?this[0].innerHTML:null},text:function(e){return 0 in arguments?this.each(function(t){var n=m(this,e,t,this.textContent);this.textContent=null==n?"":""+n}):0 in this?this[0].textContent:null},attr:function(e,t){var n;return"string"!=typeof e||1 in arguments?this.each(function(n){if(1===this.nodeType)if(i(e))for(x in e)g(this,x,e[x]);else g(this,e,m(this,t,n,this.getAttribute(e)))}):this.length&&1===this[0].nodeType?!(n=this[0].getAttribute(e))&&e in this[0]?this[0][e]:n:C},removeAttr:function(e){return this.each(function(){1===this.nodeType&&e.split(" ").forEach(function(e){g(this,e)},this)})},prop:function(e,t){return e=X[e]||e,1 in arguments?this.each(function(n){this[e]=m(this,t,n,this[e])}):this[0]&&this[0][e]},data:function(e,t){var n="data-"+e.replace(q,"-$1").toLowerCase(),o=1 in arguments?this.attr(n,t):this.attr(n);return null!==o?y(o):C},val:function(e){return 0 in arguments?this.each(function(t){this.value=m(this,e,t,this.value)}):this[0]&&(this[0].multiple?k(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(e){if(e)return this.each(function(t){var n=k(this),o=m(this,e,t,n.offset()),i=n.offsetParent().offset(),r={top:o.top-i.top,left:o.left-i.left};"static"==n.css("position")&&(r.position="relative"),n.css(r)});if(!this.length)return null;var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(t,n){if(arguments.length<2){var o,i=this[0];if(!i)return;if(o=getComputedStyle(i,""),"string"==typeof t)return i.style[E(t)]||o.getPropertyValue(t);if(Z(t)){var r={};return k.each(t,function(e,t){r[t]=i.style[E(t)]||o.getPropertyValue(t)}),r}}var a="";if("string"==e(t))n||0===n?a=l(t)+":"+d(t,n):this.each(function(){this.style.removeProperty(l(t))});else for(x in t)t[x]||0===t[x]?a+=l(x)+":"+d(x,t[x])+";":this.each(function(){this.style.removeProperty(l(x))});return this.each(function(){this.style.cssText+=";"+a})},index:function(e){return e?this.indexOf(k(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return e?N.some.call(this,function(e){return this.test(w(e))},c(e)):!1},addClass:function(e){return e?this.each(function(t){if("className"in this){T=[];var n=w(this),o=m(this,e,t,n);o.split(/\s+/g).forEach(function(e){k(this).hasClass(e)||T.push(e)},this),T.length&&w(this,n+(n?" ":"")+T.join(" "))}}):this},removeClass:function(e){return this.each(function(t){if("className"in this){if(e===C)return w(this,"");T=w(this),m(this,e,t,T).split(/\s+/g).forEach(function(e){T=T.replace(c(e)," ")}),w(this,T.trim())}})},toggleClass:function(e,t){return e?this.each(function(n){var o=k(this),i=m(this,e,n,w(this));i.split(/\s+/g).forEach(function(e){(t===C?!o.hasClass(e):t)?o.addClass(e):o.removeClass(e)})}):this},scrollTop:function(e){if(this.length){var t="scrollTop"in this[0];return e===C?t?this[0].scrollTop:this[0].pageYOffset:this.each(t?function(){this.scrollTop=e}:function(){this.scrollTo(this.scrollX,e)})}},scrollLeft:function(e){if(this.length){var t="scrollLeft"in this[0];return e===C?t?this[0].scrollLeft:this[0].pageXOffset:this.each(t?function(){this.scrollLeft=e}:function(){this.scrollTo(e,this.scrollY)})}},position:function(){if(this.length){var e=this[0],t=this.offsetParent(),n=this.offset(),o=_.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(k(e).css("margin-top"))||0,n.left-=parseFloat(k(e).css("margin-left"))||0,o.top+=parseFloat(k(t[0]).css("border-top-width"))||0,o.left+=parseFloat(k(t[0]).css("border-left-width"))||0,{top:n.top-o.top,left:n.left-o.left}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||R.body;e&&!_.test(e.nodeName)&&"static"==k(e).css("position");)e=e.offsetParent;return e})}},k.fn.detach=k.fn.remove,["width","height"].forEach(function(e){var t=e.replace(/./,function(e){return e[0].toUpperCase()});k.fn[e]=function(i){var r,a=this[0];return i===C?n(a)?a["inner"+t]:o(a)?a.documentElement["scroll"+t]:(r=this.offset())&&r[e]:this.each(function(t){a=k(this),a.css(e,m(this,i,t,a[e]()))})}}),H.forEach(function(t,n){var o=n%2;k.fn[t]=function(){var t,i,r=k.map(arguments,function(n){return t=e(n),"object"==t||"array"==t||null==n?n:W.fragment(n)}),a=this.length>1;return r.length<1?this:this.each(function(e,t){i=o?t:t.parentNode,t=0==n?t.nextSibling:1==n?t.firstChild:2==n?t:null;var s=k.contains(R.documentElement,i);r.forEach(function(e){if(a)e=e.cloneNode(!0);else if(!i)return k(e).remove();i.insertBefore(e,t),s&&b(e,function(e){null==e.nodeName||"SCRIPT"!==e.nodeName.toUpperCase()||e.type&&"text/javascript"!==e.type||e.src||window.eval.call(window,e.innerHTML)})})})},k.fn[o?t+"To":"insert"+(n?"Before":"After")]=function(e){return k(e)[t](this),this}}),W.Z.prototype=k.fn,W.uniq=S,W.deserializeValue=y,k.zepto=W,k}();return window.Zepto=t,void 0===window.$&&(window.$=t),function(e){function t(e){return e._zid||(e._zid=f++)}function n(e,n,r,a){if(n=o(n),n.ns)var s=i(n.ns);return(m[t(e)]||[]).filter(function(e){return e&&(!n.e||e.e==n.e)&&(!n.ns||s.test(e.ns))&&(!r||t(e.fn)===t(r))&&(!a||e.sel==a)})}function o(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function i(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function r(e,t){return e.del&&!w&&e.e in y||!!t}function a(e){return b[e]||w&&y[e]||e}function s(n,i,s,u,c,f,h){var p=t(n),v=m[p]||(m[p]=[]);i.split(/\s/).forEach(function(t){if("ready"==t)return e(document).ready(s);var i=o(t);i.fn=s,i.sel=c,i.e in b&&(s=function(t){var n=t.relatedTarget;return!n||n!==this&&!e.contains(this,n)?i.fn.apply(this,arguments):void 0}),i.del=f;var p=f||s;i.proxy=function(e){if(e=l(e),!e.isImmediatePropagationStopped()){e.data=u;var t=p.apply(n,e._args==d?[e]:[e].concat(e._args));return t===!1&&(e.preventDefault(),e.stopPropagation()),t}},i.i=v.length,v.push(i),"addEventListener"in n&&n.addEventListener(a(i.e),i.proxy,r(i,h))})}function u(e,o,i,s,u){var l=t(e);(o||"").split(/\s/).forEach(function(t){n(e,t,i,s).forEach(function(t){delete m[l][t.i],"removeEventListener"in e&&e.removeEventListener(a(t.e),t.proxy,r(t,u))})})}function l(t,n){return(n||!t.isDefaultPrevented)&&(n||(n=t),e.each(T,function(e,o){var i=n[e];t[e]=function(){return this[o]=C,i&&i.apply(n,arguments)},t[o]=x}),(n.defaultPrevented!==d?n.defaultPrevented:"returnValue"in n?n.returnValue===!1:n.getPreventDefault&&n.getPreventDefault())&&(t.isDefaultPrevented=C)),t}function c(e){var t,n={originalEvent:e};for(t in e)k.test(t)||e[t]===d||(n[t]=e[t]);return l(n,e)}var d,f=1,h=Array.prototype.slice,p=e.isFunction,v=function(e){return"string"==typeof e},m={},g={},w="onfocusin"in window,y={focus:"focusin",blur:"focusout"},b={mouseenter:"mouseover",mouseleave:"mouseout"};g.click=g.mousedown=g.mouseup=g.mousemove="MouseEvents",e.event={add:s,remove:u},e.proxy=function(n,o){var i=2 in arguments&&h.call(arguments,2);if(p(n)){var r=function(){return n.apply(o,i?i.concat(h.call(arguments)):arguments)};return r._zid=t(n),r}if(v(o))return i?(i.unshift(n[o],n),e.proxy.apply(null,i)):e.proxy(n[o],n);throw new TypeError("expected function")},e.fn.bind=function(e,t,n){return this.on(e,t,n)},e.fn.unbind=function(e,t){return this.off(e,t)},e.fn.one=function(e,t,n,o){return this.on(e,t,n,o,1)};var C=function(){return!0},x=function(){return!1},k=/^([A-Z]|returnValue$|layer[XY]$)/,T={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(e,t,n){return this.on(t,e,n)},e.fn.undelegate=function(e,t,n){return this.off(t,e,n)},e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this},e.fn.die=function(t,n){return e(document.body).undelegate(this.selector,t,n),this},e.fn.on=function(t,n,o,i,r){var a,l,f=this;return t&&!v(t)?(e.each(t,function(e,t){f.on(e,n,o,t,r)}),f):(v(n)||p(i)||i===!1||(i=o,o=n,n=d),(p(o)||o===!1)&&(i=o,o=d),i===!1&&(i=x),f.each(function(d,f){r&&(a=function(e){return u(f,e.type,i),i.apply(this,arguments)}),n&&(l=function(t){var o,r=e(t.target).closest(n,f).get(0);return r&&r!==f?(o=e.extend(c(t),{currentTarget:r,liveFired:f}),(a||i).apply(r,[o].concat(h.call(arguments,1)))):void 0}),s(f,t,i,o,n,l||a)}))},e.fn.off=function(t,n,o){var i=this;return t&&!v(t)?(e.each(t,function(e,t){i.off(e,n,t)}),i):(v(n)||p(o)||o===!1||(o=n,n=d),o===!1&&(o=x),i.each(function(){u(this,t,o,n)}))},e.fn.trigger=function(t,n){return t=v(t)||e.isPlainObject(t)?e.Event(t):l(t),t._args=n,this.each(function(){t.type in y&&"function"==typeof this[t.type]?this[t.type]():"dispatchEvent"in this?this.dispatchEvent(t):e(this).triggerHandler(t,n)})},e.fn.triggerHandler=function(t,o){var i,r;return this.each(function(a,s){i=c(v(t)?e.Event(t):t),i._args=o,i.target=s,e.each(n(s,t.type||t),function(e,t){return r=t.proxy(i),i.isImmediatePropagationStopped()?!1:void 0})}),r},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return 0 in arguments?this.bind(t,e):this.trigger(t)}}),e.Event=function(e,t){v(e)||(t=e,e=t.type);var n=document.createEvent(g[e]||"Events"),o=!0;if(t)for(var i in t)"bubbles"==i?o=!!t[i]:n[i]=t[i];return n.initEvent(e,o,!0),l(n)}}(t),function(e){function t(t,n,o){var i=e.Event(n);return e(t).trigger(i,o),!i.isDefaultPrevented()}function n(e,n,o,i){return e.global?t(n||w,o,i):void 0}function o(t){t.global&&0===e.active++&&n(t,null,"ajaxStart")}function i(t){t.global&&!--e.active&&n(t,null,"ajaxStop")}function r(e,t){var o=t.context;return t.beforeSend.call(o,e,t)===!1||n(t,o,"ajaxBeforeSend",[e,t])===!1?!1:void n(t,o,"ajaxSend",[e,t])}function a(e,t,o,i){var r=o.context,a="success";o.success.call(r,e,a,t),i&&i.resolveWith(r,[e,a,t]),n(o,r,"ajaxSuccess",[t,o,e]),u(a,t,o)}function s(e,t,o,i,r){var a=i.context;i.error.call(a,o,t,e),r&&r.rejectWith(a,[o,t,e]),n(i,a,"ajaxError",[o,i,e||t]),u(t,o,i)}function u(e,t,o){var r=o.context;o.complete.call(r,t,e),n(o,r,"ajaxComplete",[t,o]),i(o)}function l(){}function c(e){return e&&(e=e.split(";",2)[0]),e&&(e==k?"html":e==x?"json":b.test(e)?"script":C.test(e)&&"xml")||"text"}function d(e,t){return""==t?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function f(t){t.processData&&t.data&&"string"!=e.type(t.data)&&(t.data=e.param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()||(t.url=d(t.url,t.data),t.data=void 0)}function h(t,n,o,i){return e.isFunction(n)&&(i=o,o=n,n=void 0),e.isFunction(o)||(i=o,o=void 0),{url:t,data:n,success:o,dataType:i}}function p(t,n,o,i){var r,a=e.isArray(n),s=e.isPlainObject(n);e.each(n,function(n,u){r=e.type(u),i&&(n=o?i:i+"["+(s||"object"==r||"array"==r?n:"")+"]"),!i&&a?t.add(u.name,u.value):"array"==r||!o&&"object"==r?p(t,u,o,n):t.add(n,u)})}var v,m,g=0,w=window.document,y=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,b=/^(?:text|application)\/javascript/i,C=/^(?:text|application)\/xml/i,x="application/json",k="text/html",T=/^\s*$/,E=w.createElement("a");E.href=window.location.href,e.active=0,e.ajaxJSONP=function(t,n){if(!("type"in t))return e.ajax(t);var o,i,u=t.jsonpCallback,l=(e.isFunction(u)?u():u)||"jsonp"+ ++g,c=w.createElement("script"),d=window[l],f=function(t){e(c).triggerHandler("error",t||"abort")},h={abort:f};return n&&n.promise(h),e(c).on("load error",function(r,u){clearTimeout(i),e(c).off().remove(),"error"!=r.type&&o?a(o[0],h,t,n):s(null,u||"error",h,t,n),window[l]=d,o&&e.isFunction(d)&&d(o[0]),d=o=void 0}),r(h,t)===!1?(f("abort"),h):(window[l]=function(){o=arguments},c.src=t.url.replace(/\?(.+)=\?/,"?$1="+l),w.head.appendChild(c),t.timeout>0&&(i=setTimeout(function(){f("timeout")},t.timeout)),h)},e.ajaxSettings={type:"GET",beforeSend:l,success:l,error:l,complete:l,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:x,xml:"application/xml, text/xml",html:k,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},e.ajax=function(t){var n,i=e.extend({},t||{}),u=e.Deferred&&e.Deferred();for(v in e.ajaxSettings)void 0===i[v]&&(i[v]=e.ajaxSettings[v]);o(i),i.crossDomain||(n=w.createElement("a"),n.href=i.url,n.href=n.href,i.crossDomain=E.protocol+"//"+E.host!=n.protocol+"//"+n.host),i.url||(i.url=window.location.toString()),f(i);var h=i.dataType,p=/\?.+=\?/.test(i.url);if(p&&(h="jsonp"),i.cache!==!1&&(t&&t.cache===!0||"script"!=h&&"jsonp"!=h)||(i.url=d(i.url,"_="+Date.now())),"jsonp"==h)return p||(i.url=d(i.url,i.jsonp?i.jsonp+"=?":i.jsonp===!1?"":"callback=?")),e.ajaxJSONP(i,u);var g,y=i.accepts[h],b={},C=function(e,t){b[e.toLowerCase()]=[e,t]},x=/^([\w-]+:)\/\//.test(i.url)?RegExp.$1:window.location.protocol,k=i.xhr(),S=k.setRequestHeader;if(u&&u.promise(k),i.crossDomain||C("X-Requested-With","XMLHttpRequest"),C("Accept",y||"*/*"),(y=i.mimeType||y)&&(y.indexOf(",")>-1&&(y=y.split(",",2)[0]),k.overrideMimeType&&k.overrideMimeType(y)),(i.contentType||i.contentType!==!1&&i.data&&"GET"!=i.type.toUpperCase())&&C("Content-Type",i.contentType||"application/x-www-form-urlencoded"),i.headers)for(m in i.headers)C(m,i.headers[m]);if(k.setRequestHeader=C,k.onreadystatechange=function(){if(4==k.readyState){k.onreadystatechange=l,clearTimeout(g);var t,n=!1;if(k.status>=200&&k.status<300||304==k.status||0==k.status&&"file:"==x){h=h||c(i.mimeType||k.getResponseHeader("content-type")),t=k.responseText;try{"script"==h?(1,eval)(t):"xml"==h?t=k.responseXML:"json"==h&&(t=T.test(t)?null:e.parseJSON(t))}catch(o){n=o}n?s(n,"parsererror",k,i,u):a(t,k,i,u)}else s(k.statusText||null,k.status?"error":"abort",k,i,u)}},r(k,i)===!1)return k.abort(),s(null,"abort",k,i,u),k;if(i.xhrFields)for(m in i.xhrFields)k[m]=i.xhrFields[m];var N="async"in i?i.async:!0;k.open(i.type,i.url,N,i.username,i.password);for(m in b)S.apply(k,b[m]);return i.timeout>0&&(g=setTimeout(function(){k.onreadystatechange=l,k.abort(),s(null,"timeout",k,i,u)},i.timeout)),k.send(i.data?i.data:null),k},e.get=function(){return e.ajax(h.apply(null,arguments))},e.post=function(){var t=h.apply(null,arguments);return t.type="POST",e.ajax(t)},e.getJSON=function(){var t=h.apply(null,arguments);return t.dataType="json",e.ajax(t)},e.fn.load=function(t,n,o){if(!this.length)return this;var i,r=this,a=t.split(/\s/),s=h(t,n,o),u=s.success;return a.length>1&&(s.url=a[0],i=a[1]),s.success=function(t){r.html(i?e("<div>").html(t.replace(y,"")).find(i):t),u&&u.apply(r,arguments)},e.ajax(s),this};var S=encodeURIComponent;e.param=function(t,n){var o=[];return o.add=function(t,n){e.isFunction(n)&&(n=n()),null==n&&(n=""),this.push(S(t)+"="+S(n))},p(o,t,n),o.join("&").replace(/%20/g,"+")}}(t),function(e){e.fn.serializeArray=function(){var t,n,o=[],i=function(e){return e.forEach?e.forEach(i):void o.push({name:t,value:e})};return this[0]&&e.each(this[0].elements,function(o,r){n=r.type,t=r.name,t&&"fieldset"!=r.nodeName.toLowerCase()&&!r.disabled&&"submit"!=n&&"reset"!=n&&"button"!=n&&"file"!=n&&("radio"!=n&&"checkbox"!=n||r.checked)&&i(e(r).val())}),o},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))}),e.join("&")},e.fn.submit=function(t){if(0 in arguments)this.bind("submit",t);else if(this.length){var n=e.Event("submit");this.eq(0).trigger(n),n.isDefaultPrevented()||this.get(0).submit()}return this}}(t),function(e){"__proto__"in{}||e.extend(e.zepto,{Z:function(t,n){return t=t||[],e.extend(t,e.fn),t.selector=n||"",t.__Z=!0,t},isZ:function(t){return"array"===e.type(t)&&"__Z"in t}});try{getComputedStyle(void 0)}catch(t){var n=getComputedStyle;window.getComputedStyle=function(e){try{return n(e)}catch(t){return null}}}}(t),function(e){function t(e,t){var n=this.os={},o=this.browser={},i=e.match(/Web[kK]it[\/]{0,1}([\d.]+)/),r=e.match(/(Android);?[\s\/]+([\d.]+)?/),a=!!e.match(/\(Macintosh\; Intel /),s=e.match(/(iPad).*OS\s([\d_]+)/),u=e.match(/(iPod)(.*OS\s([\d_]+))?/),l=!s&&e.match(/(iPhone\sOS)\s([\d_]+)/),c=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),d=/Win\d{2}|Windows/.test(t),f=e.match(/Windows Phone ([\d.]+)/),h=c&&e.match(/TouchPad/),p=e.match(/Kindle\/([\d.]+)/),v=e.match(/Silk\/([\d._]+)/),m=e.match(/(BlackBerry).*Version\/([\d.]+)/),g=e.match(/(BB10).*Version\/([\d.]+)/),w=e.match(/(RIM\sTablet\sOS)\s([\d.]+)/),y=e.match(/PlayBook/),b=e.match(/Chrome\/([\d.]+)/)||e.match(/Crios\/([\d.]+)/),C=e.match(/Firefox\/([\d.]+)/),x=e.match(/MSIE\s([\d.]+)/)||e.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),k=!b&&e.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),T=k||e.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);(o.webkit=!!i)&&(o.version=i[1]),r&&(n.android=!0,n.version=r[2]),l&&!u&&(n.iOS=n.iphone=!0,n.version=l[2].replace(/_/g,".")),s&&(n.iOS=n.ipad=!0,n.version=s[2].replace(/_/g,".")),u&&(n.iOS=n.ipod=!0,n.version=u[3]?u[3].replace(/_/g,"."):null),f&&(n.wp=!0,n.version=f[1]),c&&(n.webos=!0,n.version=c[2]),h&&(n.touchpad=!0),m&&(n.blackberry=!0,n.version=m[2]),g&&(n.bb10=!0,n.version=g[2]),w&&(n.rimtabletos=!0,n.version=w[2]),y&&(o.playbook=!0),p&&(n.kindle=!0,n.version=p[1]),v&&(o.silk=!0,o.version=v[1]),!v&&n.android&&e.match(/Kindle Fire/)&&(o.silk=!0),b&&(o.chrome=!0,o.version=b[1]),C&&(o.firefox=!0,o.version=C[1]),x&&(o.ie=!0,o.version=x[1]),T&&(a||n.iOS||d)&&(o.safari=!0,n.iOS||(o.version=T[1])),k&&(o.webview=!0),n.tablet=!!(s||y||r&&!e.match(/Mobile/)||C&&e.match(/Tablet/)||x&&!e.match(/Phone/)&&e.match(/Touch/)),n.phone=!(n.tablet||n.ipod||!(r||l||c||m||g||b&&e.match(/Android/)||b&&e.match(/Crios\/([\d.]+)/)||C&&e.match(/Mobile/)||x&&e.match(/Touch/)))}t.call(e,navigator.userAgent,navigator.platform),e.__detect=t}(t),function(e,t){function n(e){return e.replace(/([a-z])([A-Z])/,"$1-$2").toLowerCase()}function o(e){return i?i+e:e.toLowerCase()}var i,r,a,s,u,l,c,d,f,h,p="",v={Webkit:"webkit",Moz:"",O:"o"},m=window.document,g=m.createElement("div"),w=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,y={};e.each(v,function(e,n){return g.style[e+"TransitionProperty"]!==t?(p="-"+e.toLowerCase()+"-",i=n,!1):void 0}),r=p+"transform",y[a=p+"transition-property"]=y[s=p+"transition-duration"]=y[l=p+"transition-delay"]=y[u=p+"transition-timing-function"]=y[c=p+"animation-name"]=y[d=p+"animation-duration"]=y[h=p+"animation-delay"]=y[f=p+"animation-timing-function"]="",e.fx={off:i===t&&g.style.transitionProperty===t,speeds:{_default:400,fast:200,slow:600},cssPrefix:p,transitionEnd:o("TransitionEnd"),animationEnd:o("AnimationEnd")},e.fn.animate=function(n,o,i,r,a){return e.isFunction(o)&&(r=o,i=t,o=t),e.isFunction(i)&&(r=i,i=t),e.isPlainObject(o)&&(i=o.easing,r=o.complete,a=o.delay,o=o.duration),o&&(o=("number"==typeof o?o:e.fx.speeds[o]||e.fx.speeds._default)/1e3),a&&(a=parseFloat(a)/1e3),this.anim(n,o,i,r,a)},e.fn.anim=function(o,i,p,v,m){var g,b,C,x={},k="",T=this,E=e.fx.transitionEnd,S=!1;if(i===t&&(i=e.fx.speeds._default/1e3),m===t&&(m=0),e.fx.off&&(i=0),"string"==typeof o)x[c]=o,x[d]=i+"s",x[h]=m+"s",x[f]=p||"linear",E=e.fx.animationEnd;else{b=[];for(g in o)w.test(g)?k+=g+"("+o[g]+") ":(x[g]=o[g],b.push(n(g)));k&&(x[r]=k,b.push(r)),i>0&&"object"==typeof o&&(x[a]=b.join(", "),x[s]=i+"s",x[l]=m+"s",x[u]=p||"linear")}return C=function(t){if("undefined"!=typeof t){if(t.target!==t.currentTarget)return;e(t.target).unbind(E,C)}else e(this).unbind(E,C);S=!0,e(this).css(y),v&&v.call(this)},i>0&&(this.bind(E,C),setTimeout(function(){S||C.call(T)},1e3*(i+m)+25)),this.size()&&this.get(0).clientLeft,this.css(x),0>=i&&setTimeout(function(){T.each(function(){C.call(this)})},0),this},g=null}(t),function(e){function t(e,t,n,o){return Math.abs(e-t)>=Math.abs(n-o)?e-t>0?"Left":"Right":n-o>0?"Up":"Down"}function n(){c=null,f.last&&(f.el.trigger("longTap"),f={})}function o(){c&&clearTimeout(c),c=null}function i(){s&&clearTimeout(s),u&&clearTimeout(u),l&&clearTimeout(l),c&&clearTimeout(c),s=u=l=c=null,f={}}function r(e){return("touch"==e.pointerType||e.pointerType==e.MSPOINTER_TYPE_TOUCH)&&e.isPrimary}function a(e,t){return e.type=="pointer"+t||e.type.toLowerCase()=="mspointer"+t}var s,u,l,c,d,f={},h=750;e(document).ready(function(){var p,v,m,g,w=0,y=0;"MSGesture"in window&&(d=new MSGesture,d.target=document.body),e(document).bind("MSGestureEnd",function(e){var t=e.velocityX>1?"Right":e.velocityX<-1?"Left":e.velocityY>1?"Down":e.velocityY<-1?"Up":null;t&&(f.el.trigger("swipe"),f.el.trigger("swipe"+t))}).on("touchstart MSPointerDown pointerdown",function(t){(!(g=a(t,"down"))||r(t))&&(m=g?t:t.touches[0],t.touches&&1===t.touches.length&&f.x2&&(f.x2=void 0,f.y2=void 0),p=Date.now(),v=p-(f.last||p),f.el=e("tagName"in m.target?m.target:m.target.parentNode),s&&clearTimeout(s),f.x1=m.pageX,f.y1=m.pageY,v>0&&250>=v&&(f.isDoubleTap=!0),f.last=p,c=setTimeout(n,h),d&&g&&d.addPointer(t.pointerId))}).on("touchmove MSPointerMove pointermove",function(e){(!(g=a(e,"move"))||r(e))&&(m=g?e:e.touches[0],o(),f.x2=m.pageX,f.y2=m.pageY,w+=Math.abs(f.x1-f.x2),y+=Math.abs(f.y1-f.y2))}).on("touchend MSPointerUp pointerup",function(n){(!(g=a(n,"up"))||r(n))&&(o(),f.x2&&Math.abs(f.x1-f.x2)>30||f.y2&&Math.abs(f.y1-f.y2)>30?l=setTimeout(function(){f.el.trigger("swipe"),f.el.trigger("swipe"+t(f.x1,f.x2,f.y1,f.y2)),f={}},0):"last"in f&&(30>w&&30>y?u=setTimeout(function(){var t=e.Event("tap");t.cancelTouch=i,f.el.trigger(t),f.isDoubleTap?(f.el&&f.el.trigger("doubleTap"),f={}):s=setTimeout(function(){s=null,f.el&&f.el.trigger("singleTap"),f={}},250)},0):f={}),w=y=0)}).on("touchcancel MSPointerCancel pointercancel",i),e(window).on("scroll",i)}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(t){e.fn[t]=function(e){return this.on(t,e)}})}(t),function(e){function t(e){return"tagName"in e?e:e.parentNode}if(e.os.iOS){var n,o={};e(document).bind("gesturestart",function(e){var i=Date.now();i-(o.last||i);o.target=t(e.target),n&&clearTimeout(n),o.e1=e.scale,o.last=i}).bind("gesturechange",function(e){o.e2=e.scale}).bind("gestureend",function(t){o.e2>0?(0!=Math.abs(o.e1-o.e2)&&e(o.target).trigger("pinch")&&e(o.target).trigger("pinch"+(o.e1-o.e2>0?"In":"Out")),o.e1=o.e2=o.last=0):"last"in o&&(o={})}),["pinch","pinchIn","pinchOut"].forEach(function(t){e.fn[t]=function(e){return this.bind(t,e)}})}}(t),function(e){function t(t){return t=e(t),!(!t.width()&&!t.height())&&"none"!==t.css("display");
}function n(e,t){e=e.replace(/=#\]/g,'="#"]');var n,o,i=s.exec(e);if(i&&i[2]in a&&(n=a[i[2]],o=i[3],e=i[1],o)){var r=Number(o);o=isNaN(r)?o.replace(/^["']|["']$/g,""):r}return t(e,n,o)}var o=e.zepto,i=o.qsa,r=o.matches,a=e.expr[":"]={visible:function(){return t(this)?this:void 0},hidden:function(){return t(this)?void 0:this},selected:function(){return this.selected?this:void 0},checked:function(){return this.checked?this:void 0},parent:function(){return this.parentNode},first:function(e){return 0===e?this:void 0},last:function(e,t){return e===t.length-1?this:void 0},eq:function(e,t,n){return e===n?this:void 0},contains:function(t,n,o){return e(this).text().indexOf(o)>-1?this:void 0},has:function(e,t,n){return o.qsa(this,n).length?this:void 0}},s=new RegExp("(.*):(\\w+)(?:\\(([^)]+)\\))?$\\s*"),u=/^\s*>/,l="Zepto"+ +new Date;o.qsa=function(t,r){return n(r,function(n,a,s){try{var c;!n&&a?n="*":u.test(n)&&(c=e(t).addClass(l),n="."+l+" "+n);var d=i(t,n)}catch(f){throw console.error("error performing selector: %o",r),f}finally{c&&c.removeClass(l)}return a?o.uniq(e.map(d,function(e,t){return a.call(e,t,d,s)})):d})},o.matches=function(e,t){return n(t,function(t,n,o){return(!t||r(e,t))&&(!n||n.call(e,null,o)===e)})}}(t),e}(e),t=function(e){return window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||clearTimeout}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(e,t){return window.setTimeout(e,1e3/60)}}(),e}(t),n=function(e){return Math.linearTween=function(e,t,n,o){return n*e/o+t},Math.easeInQuad=function(e,t,n,o){return e/=o,n*e*e+t},Math.easeOutQuad=function(e,t,n,o){return e/=o,-n*e*(e-2)+t},Math.easeInOutQuad=function(e,t,n,o){return e/=o/2,1>e?n/2*e*e+t:(e--,-n/2*(e*(e-2)-1)+t)},Math.easeInCubic=function(e,t,n,o){return e/=o,n*e*e*e+t},Math.easeOutCubic=function(e,t,n,o){return e/=o,e--,n*(e*e*e+1)+t},Math.easeInOutCubic=function(e,t,n,o){return e/=o/2,1>e?n/2*e*e*e+t:(e-=2,n/2*(e*e*e+2)+t)},Math.easeInQuart=function(e,t,n,o){return e/=o,n*e*e*e*e+t},Math.easeOutQuart=function(e,t,n,o){return e/=o,e--,-n*(e*e*e*e-1)+t},Math.easeInOutQuart=function(e,t,n,o){return e/=o/2,1>e?n/2*e*e*e*e+t:(e-=2,-n/2*(e*e*e*e-2)+t)},Math.easeInQuint=function(e,t,n,o){return e/=o,n*e*e*e*e*e+t},Math.easeOutQuint=function(e,t,n,o){return e/=o,e--,n*(e*e*e*e*e+1)+t},Math.easeInOutQuint=function(e,t,n,o){return e/=o/2,1>e?n/2*e*e*e*e*e+t:(e-=2,n/2*(e*e*e*e*e+2)+t)},Math.easeInSine=function(e,t,n,o){return-n*Math.cos(e/o*(Math.PI/2))+n+t},Math.easeOutSine=function(e,t,n,o){return n*Math.sin(e/o*(Math.PI/2))+t},Math.easeInOutSine=function(e,t,n,o){return-n/2*(Math.cos(Math.PI*e/o)-1)+t},Math.easeInExpo=function(e,t,n,o){return n*Math.pow(2,10*(e/o-1))+t},Math.easeOutExpo=function(e,t,n,o){return n*(-Math.pow(2,-10*e/o)+1)+t},Math.easeInOutExpo=function(e,t,n,o){return e/=o/2,1>e?n/2*Math.pow(2,10*(e-1))+t:(e--,n/2*(-Math.pow(2,-10*e)+2)+t)},Math.easeInCirc=function(e,t,n,o){return e/=o,-n*(Math.sqrt(1-e*e)-1)+t},Math.easeOutCirc=function(e,t,n,o){return e/=o,e--,n*Math.sqrt(1-e*e)+t},Math.easeInOutCirc=function(e,t,n,o){return e/=o/2,1>e?-n/2*(Math.sqrt(1-e*e)-1)+t:(e-=2,n/2*(Math.sqrt(1-e*e)+1)+t)},e}(n),o=function(e){return function(e){e.fn.unveil=function(t,n){function o(){var t=l.filter(function(){var t=e(this),n=r.scrollTop(),o=n+r.height(),i=t.offset().top,s=i+t.height();return s>=n-a&&o+a>=i});i=t.trigger("unveil"),l=l.not(i)}var i,r=e(window),a=t||0,s=window.devicePixelRatio>1,u=s?"data-src-retina":"data-src",l=this;return this.one("unveil",function(){var e=this.getAttribute(u);e=e||this.getAttribute("data-src"),e&&("function"==typeof n&&n.call(this),this.setAttribute("src",e))}),r.on("scroll.unveil resize.unveil lookup.unveil",o),o(),this}}(window.Zepto),e}(o),i=function(e){function t(e,t,n){!function(o){e[t]=e[n],e[n]=o}(e[t])}var n,o=function(e){var t=this;Object.keys(e).forEach(function(n){t[n]=e[n]})};o.prototype={toString:function(){return JSON.stringify(this)}};var i=function(e,t){this.old=e,this["new"]=t};i.prototype={contains:function(e){return e.length<this.length?e["new"]>=this["new"]&&e["new"]<this["new"]+this.length:!1},toString:function(){return this.length+" element subset, first mapping: old "+this.old+" → new "+this["new"]}};var r=function(e){var t=[];return"#text"!=e.nodeName&&"#comment"!=e.nodeName&&(t.push(e.nodeName),e.attributes&&(e.attributes["class"]&&t.push(e.nodeName+"."+e.attributes["class"].replace(/ /g,".")),e.attributes.id&&t.push(e.nodeName+"#"+e.attributes.id))),t},a=function(e){var t={},n={};return e.forEach(function(e){r(e).forEach(function(e){var o=e in t,i=e in n;o||i?o&&(delete t[e],n[e]=!0):t[e]=!0})}),t},s=function(e,t){var n=a(e),o=a(t),i={};return Object.keys(n).forEach(function(e){o[e]&&(i[e]=!0)}),i},u=function(e){return delete e.outerDone,delete e.innerDone,delete e.valueDone,e.childNodes?e.childNodes.every(u):!0},l=function(e,t){var n,o;if(!["nodeName","value","checked","selected","data"].every(function(n){return e[n]!==t[n]?!1:!0}))return!1;if(Boolean(e.attributes)!==Boolean(t.attributes))return!1;if(Boolean(e.childNodes)!==Boolean(t.childNodes))return!1;if(e.attributes){if(n=Object.keys(e.attributes),o=Object.keys(t.attributes),n.length!=o.length)return!1;if(!n.every(function(n){return e.attributes[n]!==t.attributes[n]?!1:void 0}))return!1}if(e.childNodes){if(e.childNodes.length!==t.childNodes.length)return!1;if(!e.childNodes.every(function(e,n){return l(e,t.childNodes[n])}))return!1}return!0},c=function(e,t,n,o,i){var r,a,u;if(!e||!t)return!1;if(e.nodeName!==t.nodeName)return!1;if("#text"===e.nodeName)return i?!0:e.data===t.data;if(e.nodeName in n)return!0;if(e.attributes&&t.attributes){if(e.attributes.id&&e.attributes.id===t.attributes.id){var l=e.nodeName+"#"+e.attributes.id;if(l in n)return!0}if(e.attributes["class"]&&e.attributes["class"]===t.attributes["class"]){var d=e.nodeName+"."+e.attributes["class"].replace(/ /g,".");if(d in n)return!0}}return o?!0:(a=e.childNodes?e.childNodes.slice().reverse():[],u=t.childNodes?t.childNodes.slice().reverse():[],a.length!==u.length?!1:i?a.every(function(e,t){return e.nodeName===u[t].nodeName}):(r=s(a,u),a.every(function(e,t){return c(e,u[t],r,!0,!0)})))},d=function(e){return JSON.parse(JSON.stringify(e))},f=function(e,t,n,o){var a,u,l=0,d=[],f=Array.apply(null,new Array(e.length+1)).map(function(){return[]}),h=s(e,t),p=e.length===t.length;return p&&e.some(function(e,n){var o=r(e),i=r(t[n]);return o.length!==i.length?(p=!1,!0):(o.some(function(e,t){return e!==i[t]?(p=!1,!0):void 0}),p?void 0:!0)}),e.forEach(function(e,i){t.forEach(function(t,r){n[i]||o[r]||!c(e,t,h,p)?f[i+1][r+1]=0:(f[i+1][r+1]=f[i][r]?f[i][r]+1:1,f[i+1][r+1]>=l&&(l=f[i+1][r+1],d=[i+1,r+1]))})}),0===l?!1:(a=[d[0]-l,d[1]-l],u=new i(a[0],a[1]),u.length=l,u)},h=function(e,t){return Array.apply(null,new Array(e)).map(function(){return t})},p=function(e,t,n){var o=e.childNodes?h(e.childNodes.length,!0):[],i=t.childNodes?h(t.childNodes.length,!0):[],r=0;return n.forEach(function(e){var t,n=e.old+e.length,a=e["new"]+e.length;for(t=e.old;n>t;t+=1)o[t]=r;for(t=e["new"];a>t;t+=1)i[t]=r;r+=1}),{gaps1:o,gaps2:i}},v=function(e,t){for(var n=e.childNodes?e.childNodes:[],o=t.childNodes?t.childNodes:[],i=h(n.length,!1),r=h(o.length,!1),a=[],s=!0,u=function(){return arguments[1]},l=function(e){i[s.old+e]=!0,r[s["new"]+e]=!0};s;)s=f(n,o,i,r),s&&(a.push(s),Array.apply(null,new Array(s.length)).map(u).forEach(l));return a},m=function(){this.list=[]};m.prototype={list:!1,add:function(e){var t=this.list;e.forEach(function(e){t.push(e)})},forEach:function(e){this.list.forEach(e)}};var g=function(e){var t,n={debug:!1,diffcap:10,maxDepth:!1,valueDiffing:!0,textDiff:function(){arguments[0].data=arguments[3]}};"undefined"==typeof e&&(e={});for(t in n)"undefined"==typeof e[t]?this[t]=n[t]:this[t]=e[t]};return g.prototype={diff:function(e,t){var o=this.nodeToObj(e),i=this.nodeToObj(t);return n=0,this.debug&&(this.t1Orig=this.nodeToObj(e),this.t2Orig=this.nodeToObj(t)),this.tracker=new m,this.findDiffs(o,i)},findDiffs:function(e,t){var o;do{if(this.debug&&(n+=1,n>this.diffcap))throw window.diffError=[this.t1Orig,this.t2Orig],new Error("surpassed diffcap:"+JSON.stringify(this.t1Orig)+" -> "+JSON.stringify(this.t2Orig));o=this.findNextDiff(e,t,[]),0===o.length&&(l(e,t)||(u(e),o=this.findNextDiff(e,t,[]))),o.length>0&&(this.tracker.add(o),this.applyVirtual(e,o))}while(o.length>0);return this.tracker.list},findNextDiff:function(e,t,n){var o;if(this.maxDepth&&n.length>this.maxDepth)return[];if(!e.outerDone){if(o=this.findOuterDiff(e,t,n),o.length>0)return e.outerDone=!0,o;e.outerDone=!0}if(!e.innerDone){if(o=this.findInnerDiff(e,t,n),o.length>0)return o;e.innerDone=!0}if(this.valueDiffing&&!e.valueDone){if(o=this.findValueDiff(e,t,n),o.length>0)return e.valueDone=!0,o;e.valueDone=!0}return[]},findOuterDiff:function(e,t,n){var i,r,a=[];return e.nodeName!==t.nodeName?[new o({action:"replaceElement",oldValue:d(e),newValue:d(t),route:n})]:e.data!==t.data?"#text"===e.nodeName?[new o({action:"modifyComment",route:n,oldValue:e.data,newValue:t.data})]:[new o({action:"modifyTextElement",route:n,oldValue:e.data,newValue:t.data})]:(i=e.attributes?Object.keys(e.attributes).sort():[],r=t.attributes?Object.keys(t.attributes).sort():[],i.forEach(function(i){var s=r.indexOf(i);-1===s?a.push(new o({action:"removeAttribute",route:n,name:i,value:e.attributes[i]})):(r.splice(s,1),e.attributes[i]!==t.attributes[i]&&a.push(new o({action:"modifyAttribute",route:n,name:i,oldValue:e.attributes[i],newValue:t.attributes[i]})))}),r.forEach(function(e){a.push(new o({action:"addAttribute",route:n,name:e,value:t.attributes[e]}))}),a)},nodeToObj:function(e){var t={},n=this;return t.nodeName=e.nodeName,"#text"===t.nodeName||"#comment"===t.nodeName?t.data=e.data:(e.attributes&&e.attributes.length>0&&(t.attributes={},Array.prototype.slice.call(e.attributes).forEach(function(e){t.attributes[e.name]=e.value})),e.childNodes&&e.childNodes.length>0&&(t.childNodes=[],Array.prototype.slice.call(e.childNodes).forEach(function(e){t.childNodes.push(n.nodeToObj(e))})),this.valueDiffing&&(e.value&&(t.value=e.value),e.checked&&(t.checked=e.checked),e.selected&&(t.selected=e.selected))),t},objToNode:function(e,t){var n,o=this;return"#text"===e.nodeName?n=document.createTextNode(e.data):"#comment"===e.nodeName?n=document.createComment(e.data):("svg"===e.nodeName||t?(n=document.createElementNS("http://www.w3.org/2000/svg",e.nodeName),t=!0):n=document.createElement(e.nodeName),e.attributes&&Object.keys(e.attributes).forEach(function(t){n.setAttribute(t,e.attributes[t])}),e.childNodes&&e.childNodes.forEach(function(e){n.appendChild(o.objToNode(e,t))}),this.valueDiffing&&(e.value&&(n.value=e.value),e.checked&&(n.checked=e.checked),e.selected&&(n.selected=e.selected))),n},findInnerDiff:function(e,t,n){var i,r,a,s,u,l=e.childNodes&&t.childNodes?v(e,t):[],c=e.childNodes?e.childNodes:[],f=t.childNodes?t.childNodes:[],h=[],p=0;if(l.length>1)return this.attemptGroupRelocation(e,t,l,n);for(r=Math.max(c.length,f.length),c.length!==f.length&&(i=!0),u=0;r>u;u+=1)a=c[u],s=f[u],i&&(a&&!s?"#text"===a.nodeName?(h.push(new o({action:"removeTextElement",route:n.concat(p),value:a.data})),p-=1):(h.push(new o({action:"removeElement",route:n.concat(p),element:d(a)})),p-=1):s&&!a&&("#text"===s.nodeName?h.push(new o({action:"addTextElement",route:n.concat(p),value:s.data})):h.push(new o({action:"addElement",route:n.concat(p),element:d(s)})))),a&&s&&(h=h.concat(this.findNextDiff(a,s,n.concat(p)))),p+=1;return e.innerDone=!0,h},attemptGroupRelocation:function(e,t,n,i){var r,a,s,u,l,f,h,v,m=p(e,t,n),g=m.gaps1,w=m.gaps2,y=Math.min(g.length,w.length),b=[],C=0;for(h=0;y>h;h+=1){if(g[h]===!0)if(u=e.childNodes[h],"#text"===u.nodeName){if("#text"===t.childNodes[h].nodeName&&u.data!==t.childNodes[h].data){for(f=h;e.childNodes.length>f+1&&"#text"===e.childNodes[f+1].nodeName;)if(f+=1,t.childNodes[h].data===e.childNodes[f].data){l=!0;break}l||b.push(new o({action:"modifyTextElement",route:i.concat(C),oldValue:u.data,newValue:t.childNodes[h].data}))}b.push(new o({action:"removeTextElement",route:i.concat(C),value:u.data})),C-=1}else b.push(new o({action:"removeElement",route:i.concat(C),element:d(u)})),C-=1;else if(w[h]===!0)u=t.childNodes[h],"#text"===u.nodeName?(b.push(new o({action:"addTextElement",route:i.concat(C),value:u.data})),C+=1):(b.push(new o({action:"addElement",route:i.concat(C),element:d(u)})),C+=1);else if(g[h]!==w[h]){if(b.length>0)return b;if(s=n[g[h]],a=Math.min(s["new"],e.childNodes.length-s.length),a!==s.old){for(r=!1,v=0;v<s.length;v+=1)c(e.childNodes[a+v],e.childNodes[s.old+v],[],!1,!0)||(r=!0);if(r)return[new o({action:"relocateGroup",groupLength:s.length,from:s.old,to:a,route:i})]}}C+=1}return b},findValueDiff:function(e,t,n){var i=[];return e.selected!==t.selected&&i.push(new o({action:"modifySelected",oldValue:e.selected,newValue:t.selected,route:n})),(e.value||t.value)&&e.value!==t.value&&"OPTION"!==e.nodeName&&i.push(new o({action:"modifyValue",oldValue:e.value,newValue:t.value,route:n})),e.checked!==t.checked&&i.push(new o({action:"modifyChecked",oldValue:e.checked,newValue:t.checked,route:n})),i},applyVirtual:function(e,t){var n=this;return 0===t.length?!0:(t.forEach(function(t){n.applyVirtualDiff(e,t)}),!0)},getFromVirtualRoute:function(e,t){var n,o,i=e;for(t=t.slice();t.length>0;){if(!i.childNodes)return!1;o=t.splice(0,1)[0],n=i,i=i.childNodes[o]}return{node:i,parentNode:n,nodeIndex:o}},applyVirtualDiff:function(e,t){var n,o,i,r=this.getFromVirtualRoute(e,t.route),a=r.node,s=r.parentNode,u=r.nodeIndex;switch(t.action){case"addAttribute":a.attributes||(a.attributes={}),a.attributes[t.name]=t.value,"checked"===t.name?a.checked=!0:"selected"===t.name?a.selected=!0:"INPUT"===a.nodeName&&"value"===t.name&&(a.value=t.value);break;case"modifyAttribute":a.attributes[t.name]=t.newValue,"INPUT"===a.nodeName&&"value"===t.name&&(a.value=t.value);break;case"removeAttribute":delete a.attributes[t.name],0===Object.keys(a.attributes).length&&delete a.attributes,"checked"===t.name?delete a.checked:"selected"===t.name?delete a.selected:"INPUT"===a.nodeName&&"value"===t.name&&delete a.value;break;case"modifyTextElement":a.data=t.newValue,"TEXTAREA"===s.nodeName&&(s.value=t.newValue);break;case"modifyValue":a.value=t.newValue;break;case"modifyComment":a.data=t.newValue;break;case"modifyChecked":a.checked=t.newValue;break;case"modifySelected":a.selected=t.newValue;break;case"replaceElement":n=d(t.newValue),n.outerDone=!0,n.innerDone=!0,n.valueDone=!0,s.childNodes[u]=n;break;case"relocateGroup":a.childNodes.splice(t.from,t.groupLength).reverse().forEach(function(e){a.childNodes.splice(t.to,0,e)});break;case"removeElement":s.childNodes.splice(u,1);break;case"addElement":o=t.route.slice(),i=o.splice(o.length-1,1)[0],a=this.getFromVirtualRoute(e,o).node,n=d(t.element),n.outerDone=!0,n.innerDone=!0,n.valueDone=!0,a.childNodes||(a.childNodes=[]),i>=a.childNodes.length?a.childNodes.push(n):a.childNodes.splice(i,0,n);break;case"removeTextElement":s.childNodes.splice(u,1),"TEXTAREA"===s.nodeName&&delete s.value;break;case"addTextElement":o=t.route.slice(),i=o.splice(o.length-1,1)[0],n={},n.nodeName="#text",n.data=t.value,a=this.getFromVirtualRoute(e,o).node,a.childNodes||(a.childNodes=[]),i>=a.childNodes.length?a.childNodes.push(n):a.childNodes.splice(i,0,n),"TEXTAREA"===a.nodeName&&(a.value=t.newValue);break;default:console.log("unknown action")}},apply:function(e,t){var n=this;return 0===t.length?!0:(t.forEach(function(t){return n.applyDiff(e,t)?void 0:!1}),!0)},getFromRoute:function(e,t){t=t.slice();for(var n,o=e;t.length>0;){if(!o.childNodes)return!1;n=t.splice(0,1)[0],o=o.childNodes[n]}return o},applyDiff:function(e,t){var n,o,i,r,a=this.getFromRoute(e,t.route);switch(t.action){case"addAttribute":if(!a||!a.setAttribute)return!1;a.setAttribute(t.name,t.value);break;case"modifyAttribute":if(!a||!a.setAttribute)return!1;a.setAttribute(t.name,t.newValue);break;case"removeAttribute":if(!a||!a.removeAttribute)return!1;a.removeAttribute(t.name);break;case"modifyTextElement":if(!a||3!==a.nodeType)return!1;this.textDiff(a,a.data,t.oldValue,t.newValue);break;case"modifyValue":if(!a||"undefined"==typeof a.value)return!1;a.value=t.newValue;break;case"modifyComment":if(!a||"undefined"==typeof a.data)return!1;a.data=t.newValue;break;case"modifyChecked":if(!a||"undefined"==typeof a.checked)return!1;a.checked=t.newValue;break;case"modifySelected":if(!a||"undefined"==typeof a.selected)return!1;a.selected=t.newValue;break;case"replaceElement":a.parentNode.replaceChild(this.objToNode(t.newValue),a);break;case"relocateGroup":Array.apply(null,new Array(t.groupLength)).map(function(){return a.removeChild(a.childNodes[t.from])}).forEach(function(e,n){0===n&&(o=a.childNodes[t.to]),a.insertBefore(e,o)});break;case"removeElement":a.parentNode.removeChild(a);break;case"addElement":i=t.route.slice(),r=i.splice(i.length-1,1)[0],a=this.getFromRoute(e,i),a.insertBefore(this.objToNode(t.element),a.childNodes[r]);break;case"removeTextElement":if(!a||3!==a.nodeType)return!1;a.parentNode.removeChild(a);break;case"addTextElement":if(i=t.route.slice(),r=i.splice(i.length-1,1)[0],n=document.createTextNode(t.value),a=this.getFromRoute(e,i),!a||!a.childNodes)return!1;a.insertBefore(n,a.childNodes[r]);break;default:console.log("unknown action")}return!0},undo:function(e,t){t=t.slice();var n=this;t.length||(t=[t]),t.reverse(),t.forEach(function(t){n.undoDiff(e,t)})},undoDiff:function(e,n){switch(n.action){case"addAttribute":n.action="removeAttribute",this.applyDiff(e,n);break;case"modifyAttribute":t(n,"oldValue","newValue"),this.applyDiff(e,n);break;case"removeAttribute":n.action="addAttribute",this.applyDiff(e,n);break;case"modifyTextElement":t(n,"oldValue","newValue"),this.applyDiff(e,n);break;case"modifyValue":t(n,"oldValue","newValue"),this.applyDiff(e,n);break;case"modifyComment":t(n,"oldValue","newValue"),this.applyDiff(e,n);break;case"modifyChecked":t(n,"oldValue","newValue"),this.applyDiff(e,n);break;case"modifySelected":t(n,"oldValue","newValue"),this.applyDiff(e,n);break;case"replaceElement":t(n,"oldValue","newValue"),this.applyDiff(e,n);break;case"relocateGroup":t(n,"from","to"),this.applyDiff(e,n);break;case"removeElement":n.action="addElement",this.applyDiff(e,n);break;case"addElement":n.action="removeElement",this.applyDiff(e,n);break;case"removeTextElement":n.action="addTextElement",this.applyDiff(e,n);break;case"addTextElement":n.action="removeTextElement",this.applyDiff(e,n);break;default:console.log("unknown action")}}},window.diffDOM=g,e}(i),r=function(e){return function(e){e.fn.superHtml=e.fn.html,e.fn.html=diffDOM?function(e,t){if(t&&this._diffdom){var n,o=this[0].cloneNode(),i=new diffDOM(t);return o.innerHTML=e,n=i.diff(this[0],o),i.apply(this[0],n)||this.superHtml.apply(this,arguments),this.eq(0).trigger("virtualdomrendered"),this}this._diffdom=1;var r=this.superHtml.apply(this,arguments);return this.eq(0).trigger("virtualdomrendered"),r}:e.fn.superHtml}(window.Zepto),e}(r),a=function(e){var t=function(){function e(e){e&&document.body.appendChild(e)}function t(e){e&&e.parentNode.removeChild(e)}function n(t,n){var o=document.createElement("iframe");return o.setAttribute("style","display:none;width:0;height:0;position: absolute;top:0;left:0;border:0;"),o.setAttribute("height","0px"),o.setAttribute("width","0px"),o.setAttribute("frameborder","0"),n&&o.setAttribute("name",n),t?o.setAttribute("src",t):e(o),o}function o(e,t,n,o,r){var a,s;a=n?JSON.stringify(n):"",e&&"object"==typeof e&&e[t]?e[t](a):(s=e,"string"==typeof t&&t.length>0&&(s+=t+"/"+a),i(s,o,r))}function i(o,i,a){var u,l;return a?void(window.location.href=o):void(i?(s?(u=n(),u.setAttribute("src",o)):(u=n(o),e(u)),l=setTimeout(function(){u&&t(u)},3e4),u.onload=u.onreadystatechange=function(){l&&clearTimeout(l),u&&t(u)}):(r=r||n(),r.setAttribute("src",o)))}var r,a=/Android/gi,s=a.test(navigator.platform)||a.test(navigator.userAgent);return r=null,{protocol:i,excute:o,getFrame:n,appendFrame:e,removeFrame:t}}();return t}(a),s=function(e){function t(e){this._subject=e,this.observers=[]}return t.prototype={register:function(e){if(!e)throw new Error("An observer can not be undefined!");if("object"==typeof e&&"function"!=typeof e.update)throw{name:"Error",method:"Subject.register",message:"An observer object can not register without an update method!"};return this.unregister(e),this.observers.push(e),this},unregister:function(e){return this.observers=this.observers.filter(function(t){return t!==e?t:void 0}),this},notify:function(){var e=[].slice.call(arguments);return this.observers.forEach(function(t){"function"==typeof t?t.apply(t,e):t.update.apply(t,e)}),this}},t}(s),u=function(e){var t=function(e){function t(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}function n(e){for(var t=0;t<u.length;t++)if(e.hasAttribute(u[t]))return!0;return!1}function o(e){for(var t=0;t<u.length;t++)e.removeAttribute(u[t])}function i(e){if(t(e))if(n(e)||"script"==e.tagName.toLowerCase()){var i=e.innerHTML;e.innerHTML="",o(e),e=i}else e=e.outerHTML;return e&&e.toString().replace(/(micro|ntes)-(template)?/g,"")}function r(t,n){t=i(t);var o=new RegExp("((^|"+s+")[^	]*)'","g"),r=new RegExp("	"+(e?"":"=")+"(.*?)"+s,"g"),u=/\W/.test(t)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split(a).join("	").replace(o,"$1\r").replace(r,"',$1,'").split("	").join("');").split(s).join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):l[t]=l[t];return n?u(n):u}var a=e?"{{":"<%",s=e?"}}":"%>",u=["micro-template-child","ntes-template-child"],l={};return r};return t}(u),l=function(e){function t(e,t,n){if(t){var o;for(o in t)e[o]=n?n(t[o]):t[o]}}function n(e,t,n){if(t){var o;for(o in t)e[o]||(e[o]=n?n(t[o]):t[o])}}function o(e,t){if(null===e||void 0===e||null===t||void 0===t)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Function)return e===t;if(e instanceof RegExp)return e===t;if(e===t||e.valueOf()===t.valueOf())return!0;if(Array.isArray(e)&&e.length!==t.length)return!1;if(e instanceof Date)return!1;if(!(e instanceof Object))return!1;if(!(t instanceof Object))return!1;var n=Object.keys(e);return Object.keys(t).every(function(e){return-1!==n.indexOf(e)})&&n.every(function(n){return o(e[n],t[n])})}function i(){var e=0,t=3e5,n={};this.isTimeout=function(o,i){return o=t*(o||1),i=void 0!==i?n[i]:e,!i||(new Date).getTime()-i>o},this.update=function(t){var o=(new Date).getTime();void 0!==t?void 0===n[t]?this.reset(t):n[t]=o:e=o},this.reset=function(t){void 0!==t?n[t]=0:e=0},this.resetAll=function(){n={},e=0}}function r(e){r.superclass.constructor.call(this),this.updated=this.register,this.refresh=this.notify,this.data,t(this,e),this.updateFactory=i,this.timer=new i}var a,u=s;Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=n.length;return function(i){if("object"!=typeof i&&("function"!=typeof i||null===i))throw new TypeError("Object.keys called on non-object");var r,a,s=[];for(r in i)e.call(i,r)&&s.push(r);if(t)for(a=0;o>a;a++)e.call(i,n[a])&&s.push(n[a]);return s}}());var l=function(){var e=function(){};return function(t,n){return e.prototype=t.prototype,n.prototype=new e,n.prototype.constructor=n,n.superclass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t),n}}();return l(u,r),r.prototype.store=function(e,t){this._cacheStore=this._cacheStore||{},t&&e&&("object"==typeof t&&"[object Array]"!=toString.call(t)&&(t.__STORE_ID=e),this._cacheStore[e]=t)},r.prototype.set=function(e,t,n){n=n&&o(this.data,e),this.data=e,t&&this.store(t,e),!n&&this.refresh(),this.timer.update()},r.prototype.get=function(e){return e&&"object"==typeof this.data?JSON.parse(JSON.stringify(this.data)):this.data},r.prototype.getFromStoreById=function(e,t){return e&&this._cacheStore&&(t&&"object"==typeof this._cacheStore[e]?JSON.parse(JSON.stringify(this._cacheStore[e])):this._cacheStore[e])},a={objectEquals:o,apply:t,applyIf:n,extend:l,Model:r}}(l),c=function(e){function t(e){function t(){v=!0}function n(){return p||v}function o(t,n){if(e(t,!0),v&&n){var o=t.match(/[\w]:\/\/(.*)/);"function"==typeof n&&n(o&&o[1])}}function i(e,t){t=t||h,"function"==typeof t&&t(e),t=h}function r(e,t){null!=t&&void 0!=t&&(/object/i.test(typeof t)||(t={"default":t}),f[C+e]=t)}function a(e,t){/function/i.test(typeof t)?f[x+e]=t:delete f[x+e]}function s(e,t){var n=T+e;d[n]=t||function(t){r(e,t)}}function u(e){var t=E+e;d[t]=function(t){a(e,t)}}function l(e,t){return g[e]=y+e,m[e]=h,f[k+e]=function(t){i(t,m[e])},s(e),d[e]=t||function(t,i,a){r(e,t),m[e]=i,n()&&(f[b]&&f[b][e]?f[b][e]():o(g[e]+(a?"/"+a:""),i))},d[e]}function c(e){var t=d[e],n=[].slice.call(arguments,1);t||(t=l(e)),t.apply(d,n)}var d=this,f=window,h=function(){},p=/Rings/gi.test(navigator.userAgent),v=!1,m={},g={},w="ringsmozat",y=w+"://",b="__"+w,C=b+"_data_",x=b+"_before_",k=b+"_after_",T="set_data_for_",E="set_before_for_";m={},g={},this.isApp=n,this.enableDebug=t,this.trigger=c,["userInfo","login","share","modifytitle","updateBarButton","setBgColor","copy","closeweb"].forEach(function(e,t){l(e)}),["facebook","twitter","instagram"].forEach(function(e,t){d["share_"+e]=function(t,n){d.share(t,n,e)},d[T+"share_"+e]=d[T+"share"]}),["unload"].forEach(function(e,t){u(e)})}var n=a;return new t(n.protocol)}(c),d=function(e){function t(e){function t(t,n){var o;for(var r in s)if(r===t){o=s[r];break}return o||(o=new e,i(t,o)),o.register(n),this}function n(e){return r(e),this}function o(e){var t=[].slice.call(arguments);return s[e]&&s[e].notify.apply(s[e],t.slice(1)),this}function i(e,t){s[e]=t}function r(e){delete s[e]}function a(){var e=[];for(var t in s)"string"==typeof t&&e.push(t);return e}var s={};this.getTopics=a,this.subscribe=t,this.unsubscribe=n,this.publish=o}return t}(d),f=function(e){var t=function(){function e(e){var t;return e&&decodeURIComponent(e).replace(new RegExp("#(.*)","g"),function(e,n){t=n}),t}function t(){return e(o.hash)}function n(e){o.hash=e}var o=window.location;return{get:t,set:n,getByURL:e}}();return t}(f),h=function(e){function t(e,t){function n(e){e=e||H||"";var t=function(e,t){if(e){var n={};return e.replace(t,function(e,t,o,i){n[t]=i}),n}};return t(e,new RegExp("([^?=&]+)(=([^&]*))?","g"))||{}}function o(e){return e&&(e=e.replace(/\?.*/g,"")),e}function i(e){e&&e.preventDefault();var n,i=arguments[0]||{};return n={curHash:o(t.get()),newHash:o(t.getByURL(i.newURL)),oldHash:o(t.getByURL(i.oldURL))},T(),N(),R=n,V=n.curHash||_,g(n.curHash),O&&O(n.curHash,n),U&&(h(n.curHash,n),r(n)),n.curHash&&b(n.curHash),!1}function r(t){var o=e.getTopics(),i=!1;if(void 0!==t.curHash)for(var r=0;r<o.length;r++){var a=o[r];a!==_&&t.curHash.replace(new RegExp("^"+a+"(.*)","g"),function(o,r){o&&(H=r,i=!0,D=a,A(),e.publish(a,{action:a,param:r,hash:t,query:n(r)}))})}i||(D=_,H=t.curHash,A(),e.publish(_,{action:t.curHash,param:t.curHash,hash:t,query:n(t.curHash)}))}function a(t){if(null===t||void 0===t||""===t)f();else{var n=new RegExp("^"+t+"(.*)","i");q&&!n.test(q)?(O=function(e){e===q?(O=null,setTimeout(function(){f()},0)):e===t&&p(q)},p(t)):f()}return e}function s(t){return t?e.publish(t,{action:t,param:H,hash:R,query:n()}):i(),e}function u(t,n){return l(_,t,n),e}function l(t,n,o){return j.call(e,t,n),o&&j.call(e,B+t,o),e}function c(t){return"function"==typeof t&&G.push(t),e}function d(t){return"function"==typeof t&&z.push(t),e}function f(){if(U=!0,z.length)for(;z.length;)z.shift().call(I,e);else s()}function h(){for(var t=0,n=G.length;n>t;t++)G[t].apply(void 0,arguments);D&&e.publish(B+D)}function p(n){return F=!0,null===n?window.history.forward():"number"==typeof n?(-1==n&&(F=!1),window.history.go(n)):"string"==typeof n&&(P?(window.history.pushState(null,null,"#"+n),s()):t.set(n)),e}function v(e){console.log("here"),window.history.pushState(null,null,e||Core.localHost)}function m(t){var n=w()||t||-1;return window.history.length>1&&(n=-1),p(n),e}function g(e){var t=[].concat.call($).pop();t!=e&&$.push(e)}function w(){return $.pop(),$.pop()}function y(){return F}function b(e){return}function C(e,t){var n,o=[],i=0;for("string"==typeof e?o.push(e):"[object Array]"==toString.call(e)&&(o=o.concat(e)),n=o.length;n>i;i++)if(new RegExp("^"+o[i]+"(.*)","i").test(t))return!0;return!1}function x(e){return C(e,V||_)}function k(e){var t=[].concat.call($);return t.pop(),C(e,t.pop()||_)}function T(e,t){e=e||V,e&&(J[e]=t||window.pageYOffset||window.scrollY||document.body.scrollTop)}function E(e){return e=e||V,e&&J[e]}function S(e){window.scrollTo(0,E(e)||1),T(e,0)}function N(e,t){e=e||V,e&&(W[e]=t||document.title)}function M(e){return e=e||V,e&&W[e]}function A(e){var t=M(e);t&&(document.title=t)}var R,D,O,I=this,j=e.subscribe,L=/Android/gi.test(navigator.userAgent),P=/(iPad|iPhone|iPod)/gi.test(navigator.userAgent)&&!L,_="__UN_SUBSCRIBED_ACTION",q=o(t.get()),V=q||_,H="",B="__",F=!0,$=[q],U=!1,z=[],G=[],J={},W={};return P?window.addEventListener("popstate",i,!1):window.addEventListener("hashchange",i,!1),e.initHash=q,e.init=a,e.run=s,e.forward=p,e.back=m,e.refine=v,e.isFroward=y,e.currentMatch=x,e.lastMatch=k,e.onReady=d,e.onChanged=c,e.subscribe=l,e.onUnsubscribed=u,e.getQuery=n,e.getHistoryPosition=E,e.scrollToHistoryPosition=S,e.getHistoryTitle=M,e.getUnsubscribedAction=function(){return _},e}var n=d,o=s,i=f;return t(new n(o),i)}(h),p=function(e){function t(e){t.superclass.constructor.call(this,e),this.on=this.subscribe,this.off=this.unsubscribe,this.trigger=this.publish}var n=l,o=d,i=s;return n.extend(o,t),new t(i)}(p),v=function(e){function t(){function e(e){return o?o[e]:null}function t(e,t){if(o)if("object"==typeof e)for(var n in e)try{e[n]&&o.setItem(n,e[n])}catch(i){}else try{o.setItem(e,t)}catch(i){}return this}function n(e){if(o)if("object"==typeof e)for(var t in e)try{o.removeItem(e[t])}catch(n){}else try{o.removeItem(e)}catch(n){}return this}var o=window.localStorage;this.set=t,this.get=e,this.del=n}return new t}(v),m=function(e){return window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),window.location.origin}(m),g=function(e){function t(e,t){e=e||window.location.search,t=t||window.location.hash;var n=function(e,t){if(e){var n={};return e.replace(t,function(e,t,o,i){n[t]=i}),n}};return{search:n(e,new RegExp("([^?=&]+)(=([^&]*))?","g"))||{},hash:n(t,new RegExp("([^#=&]+)(=([^&]*))?","g"))||{}}}return t}(g),w=function(e){var t=navigator.userAgent,n=t.match(/(Android);?[\s\/]+([\d.]+)?/),o=t.match(/(iPad).*OS\s([\d_]+)/),i=t.match(/(iPod)(.*OS\s([\d_]+))?/),r=!o&&t.match(/(iPhone\sOS)\s([\d_]+)/),a={};n&&(a.android=!0,a.version=n[2]),r&&!i&&(a.ios=a.iphone=!0,a.version=r[2].replace(/_/g,".")),o&&(a.ios=a.ipad=!0,a.version=o[2].replace(/_/g,".")),i&&(a.ios=a.ipod=!0,a.version=i[3]?i[3].replace(/_/g,"."):null);var s=function(){function e(){o=document.getElementsByTagName("meta");for(var e=0;e<o.length;e++){var n=o[e].name;n&&(r[n]={},r[n].el=o[e],r[n].content=o[e].content,r[n].seriation=r[n].content.split(","),r[n].store=t(n))}return i}function t(e){for(var t=r[e].seriation,n={},o=0;o<t.length;o++)if(t[o].length<1)t[o]=null,delete t[o],t.length--;else{var i=t[o].split("="),a=i[0];a&&(n[a]=i[1])}return n}function n(e){return r[e].content=r[e].seriation.join(","),i.setContent(e,r[e].content),i}if(s.prototype.instance)return s.prototype.instance;var o,i=this,r={};this.hasMeta=function(e){return r[e]?1:0},this.createMeta=function(e){if(!this.hasMeta(e)){var t=document.createElement("meta");t.name=e,document.head.appendChild(t),r[e]={},r[e].el=t,r[e].content="",r[e].seriation=[],r[e].store={}}return i},this.setContent=function(e,t){
return r[e].content=t,r[e].el.content=t,i},this.getContent=function(e){return r[e]&&r[e].content},this.removeContentProperty=function(e,t){var o=t;if(r[e]){if(null!=r[e].store[o])for(var a=0;a<r[e].seriation.length;a++)if(-1!=r[e].seriation[a].indexOf(t+"=")){r[e].seriation[a]=null,delete r[e].seriation[a];break}n(e)}return i},this.getContentProperty=function(e,t){return r[e]&&r[e].store[t]},this.setContentProperty=function(e,t,o){var a=t,s=t+"="+o;if(r[e]){if(null!=r[e].store[a]){r[e].store[a]=o;for(var u=0;u<r[e].seriation.length;u++)if(-1!=r[e].seriation[u].indexOf(t+"=")){r[e].seriation[u]=s;break}}else r[e].store[a]=o,r[e].seriation.push(s);n(e)}return i},this.fixViewportWidth=function(e,t){if(e=e||i.getContentProperty("viewport","width"),"device-width"!=e){var n=window.innerWidth||e,o=window.outerWidth||n,r=window.screen.width||n,s=window.screen.availWidth||n,u=window.innerHeight||e,l=window.outerHeight||u,c=window.screen.height||u,d=window.screen.availHeight||u,f=Math.min(n,o,r,s,u,l,c,d),h=f/e,p=window.devicePixelRatio;h=Math.min(h,p),t&&(document.body.style.width=e+"px"),a.android?i.removeContentProperty("viewport","user-scalable").setContentProperty("viewport","target-densitydpi","device-dpi").setContentProperty("viewport","initial-scale",h).setContentProperty("viewport","maximum-scale",h):a.ios&&!a.android&&(i.setContentProperty("viewport","user-scalable","no"),a.ios&&parseInt(a.version)<7&&i.setContentProperty("viewport","initial-scale",h))}},e(),s.prototype.instance=this};return new s}(w),y=function(e){var t=function(){function e(e){if(e){var t={};for(var n in e)t[n]=e[n];t.url=t.action||t.url,t.data=t.data||null,delete t.complete,delete t.action,t.success=function(t,n,o){e.complete&&"function"==typeof e.complete&&e.complete({data:t,success:!0})},t.error=function(t,n,o){e.complete&&"function"==typeof e.complete&&e.complete({success:!1})},$.ajax(t)}}function t(e){e&&$.ajax({type:"GET",url:e.action||e.url,dataType:"jsonp",jsonp:!1,jsonpCallback:!1,contentType:"application/json",data:e.data||null})}function n(t){t&&(t.type="GET",t.dataType="json",e(t))}function o(t){t&&(t.type="POST",t.dataType="json",e(t))}return{getJSON:n,postJSON:o,JSONP:t}}();return t}(y),b=function(e){var t=function(e,t){if(typeof e+typeof t!="stringstring")return!1;for(var n=e.split("."),o=t.split("."),i=0,r=Math.max(n.length,o.length);r>i;i++){if(n[i]&&!o[i]&&parseInt(n[i])>0||parseInt(n[i])>parseInt(o[i]))return 1;if(o[i]&&!n[i]&&parseInt(o[i])>0||parseInt(n[i])<parseInt(o[i]))return-1}return 0};return t}(b),C=function(e){var t=a,n=function(){function e(e){var t=document.createElement("form");return t.setAttribute("style","display:none;width:0;height:0;position: absolute;top:0;left:0;border:0;"),t.setAttribute("method",e||"POST"),t}if(n.prototype.instance)return n.prototype.instance;this.asyncSubmit=function(e,t){this.submit(e,t,!0)},this.submit=function(n,o,i){var r,a,s=e(),u=[],l='<input type="text" name="{N}" value="{V}" />';i&&(r="__formhandler_"+(new Date).getTime(),a=t.getFrame(null,r),s.setAttribute("target",r),setTimeout(function(){t.removeFrame(a)},12e4)),s.setAttribute("action",n),o=o||{};for(var c in o)u.push(l.replace("{N}",c).replace("{V}",o[c]));s.innerHTML=u.join(""),n&&setTimeout(function(){s.submit()},100)},n.prototype.instance=this};return new n}(C),x=function(e){function t(e,t,n,o){function i(e){e=e.sort(function(){return.5-Math.random()})}var r=[],a=e.slice(0);for(t=t||a.length,o=o?o:0;o;)i(a),o--;if(a.length<=t)r=a;else for(;r.length<t;){var s=Math.floor(Math.random()*a.length),u=a[s];(n&&n.call(this,u,a)||!n)&&(r.push(u),a.splice(s,1))}return r}return t}(x),k=function(e){function t(e){return e.toFixed(2).replace(/./g,function(e,t,n){return!t||"."===e||(n.length-t)%3?e:","+e})}function n(e){function t(){!u&&a>=n||u&&n>=a?r.innerHTML=n:(r.innerHTML=a,a+=u?-s:s,setTimeout(t,o))}if(e=e||{},e.el){var n=e.dest||0,o=e.rate||50,i=e.duration||1500,r=e.el,a=parseInt(r.innerHTML)||0,s=Math.round(Math.abs(a-n)/(i/o))||1,u=a>n;t()}}return{formatMoney:t,countNum:n}}(k),T=function(e){var t=function(){function e(e){var t;if("string"==typeof e){var n=e.split(/[- :]/);t=new Date(n[0],n[1]-1,n[2],n[3]||0,n[4]||0,n[5]||0)}return t}function t(e){return 10>e?"0"+e:e}function n(e){if(!e)return null;var n=e.getFullYear(),o=e.getMonth(),i=e.getDate(),r=e.getHours(),a=e.getMinutes(),s=e.getSeconds();return{year:n,month:t(o+1),day:t(i),hour:t(r),minute:t(a),second:t(s)}}function o(t){var o=e(t);return n(o)}function i(n){if(!n)return null;var o;if("string"==typeof n?o=e(n):"number"==typeof n?o=new Date(n):n.getTime&&(o=n),!o)return null;var i=o.getTime(),r=(new Date).getTime(),a=Math.abs(r-i),s=Math.floor(a/864e5),u=Math.floor((a-24*s*60*60*1e3)/36e5),l=Math.floor((a-60*u*60*1e3-24*s*60*60*1e3)/6e4),c=Math.floor((a-60*u*60*1e3-24*s*60*60*1e3-60*l*1e3)/1e3);return{day:t(s),hour:t(u),minute:t(l),second:t(c)}}function r(e){var t=i(e);if(!t)return null;var n=parseInt(t.day),o=parseInt(t.hour),r=parseInt(t.minute);return n>0?n+" days ago":o>0?o+" hours ago":r>=3?r+" mins ago":"just now"}function a(e,t){return/8|3|5|10/.test(--t)?30:1==t?(e%4||!(e%100))&&e%400?28:29:31}return{getStrDate:e,getMeta:n,formatStr:o,fromNowTo:i,timeLogFromNowTo:r,getDaysInMonth:a}}();return t}(T),E=function(e){var t=a,n=s,o=u,i=l,r=c,d=h,E=f,S=p,N=v,M=m,A=g,R=w,D=y,O=b,I=C,j=x,L=k,P=T,_={localStorage:N,localHost:M,localParam:A,Navigator:t,MetaHandler:R,Subject:n,microTmpl:o(),Class:i,extend:i.extend,HashHandler:E,RequestHandler:D,NativeBridge:r,versionCompare:O,FormHandler:I,Event:S,Router:d,Num:L,randomList:j,DateHandler:P};return 1==A().search.debug&&_.NativeBridge.enableDebug(),window.Core=_,_}(E),S=function(e){var t={dev:"http://dev.rings.me",test:"http://test.rings.me",prod:"https://www.rings.tv"},n={dev:"ws://192.168.128.12:11113/chat",test:"ws://192.168.128.12:11113/chat",prod:"wss://client.rings.me/chat"},o="prod",i={User:{view:t[o]+"/account/load-profile",rename:t[o]+"/account/set-name"},Replay:{view:t[o]+"/api/replay-video/view",owner:t[o]+"/api/replay-video/replays",index:t[o]+"/api/replay-video",tag:t[o]+"/api/replay-video/tag"},Live:{view:t[o]+"/api/live-video/view",index:t[o]+"/api/live-video",messages:t[o]+"/api/live-video/messages"},Event:{view:t[o]+"/api/event/view",index:t[o]+"/api/event",register:t[o]+"/api/event/register",unregister:t[o]+"/api/event/unregister"},Channel:{isFollowed:t[o]+"/api/channel/is-followed",follow:t[o]+"/api/channel/follow",unfollow:t[o]+"/api/channel/unfollow",count:t[o]+"/channel/get-viewer-count",view:t[o]+"/channel/details"},Eventinfo:{isPrivate:t[o]+"/api/eventinfo/private"},host:t[o],chatRoom:n[o]};return i}(S),N=function(e){function t(e){var t=new RegExp(e,"gi");return t.test(n)}var n=window.navigator.userAgent,o=null;return t("Deja")?o={code:"Deja",name:"DejaFashion"}:t("FBAN")?o={code:"Facebook",name:"Facebook"}:t("Twitter")?o={code:"Twitter",name:"Twitter"}:t("Instagram")?o={code:"Instagram",name:"Instagram"}:t("weibo")?o={code:"Weibo",name:"微博"}:t("MicroMessenger")?o={code:"WX",name:"微信"}:t("QQ")?o={code:"QQ",name:"QQ"}:t("YiXin")&&(o={code:"YX",name:"易信"}),o}(N),M=function(e){function t(e,t,n,i,r){r=r||{};var a,s;t=t||{},t._t=(new Date).getTime(),a=t.__STORE_ID,delete t.__STORE_ID,s={action:e,data:t,complete:function(e){e.success&&i&&i.set&&i.set(e.data,a),n&&n(e.success)}};for(var u in r)s[u]=r[u];s.action=e,s.data=t,o(s)}function n(e,t,n,o,r){r=r||{};var a={action:e,data:t,contentType:r.contentType||"application/json;charset=utf-8",complete:function(e){e.success&&o&&o.set&&o.set(e.data),n&&n(e.success)}};for(var s in r)a[s]=r[s];a.action=e,a.data=t,i(a)}var o=Core.RequestHandler.getJSON,i=Core.RequestHandler.postJSON,r=Core.RequestHandler.JSONP;return{getJSON:o,postJSON:i,JSONP:r,request:t,post:n}}(M),A=function(e){function t(){var e,t,i,r="loginCookieTimer_";this.getCookie=function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},this.setCookie=function(e,t,n){var o="; path=/";if(void 0!==n){var i=new Date,r=-i.getTimezoneOffset()/60;i.setTime(+i+60*(n+r)*60*1e3),o="; expires="+i.toUTCString()+"; path=/"}return document.cookie=e+"="+t+o,t},this.verifyLoginCookie=function(){var e=this.getCookie("userID"),t=this.getCookie("token");return this.setUserId(e),e&&t},this.saveLoginCookieTimeout=function(){var e=r+this.getUserId();o.set(e,(new Date).getTime())},this.verifyLoginCookieTimeout=function(e){var t=r+this.getUserId(),n=o.get(t)||0;return e=e||1440,(new Date).getTime()-n<60*e*1e3},this.setUdId=function(e){t=e},this.getUdId=function(){return t},this.setUserId=function(t){e=t||e},this.getUserId=function(){return e||i&&i.userid||this.getCookie("uid")},this.getAppUserMeta=function(){return i},this.setAppUserMeta=function(e){i=e},this.isLogined=function(){return!!this.getUserId()},this.modelUpdate=new n}var n=Core.Class.Model,o=Core.localStorage;return new t}(A),R=function(e){function t(){function e(){Core.MetaHandler.fixViewportWidth(),t(),i(),u.hide(),s.body.css({visibility:"visible"})}function t(){var e=$("body");s={body:e,views:e.children(".view")},u.GlobalTouch={preventMove:!1,touched:!1},window.GlobalTouch=u.GlobalTouch}function i(){document.addEventListener("touchmove",function(e){u.GlobalTouch.preventMove&&e.preventDefault()},!1),document.addEventListener("touchstart",function(e){u.GlobalTouch.touched=!0},!1),document.addEventListener("touchend",function(e){u.GlobalTouch.touched=!1},!1),s.body.on("click",".btn-logo",function(e){location.href="/user"}),s.body.on("touchstart","* [data-prevent-move]",function(){u._BasicView.GlobalTouch.preventMove=!0}),s.body.on("touchend",'* [data-prevent-move="start"]',function(){u._BasicView.GlobalTouch.preventMove=!1}),"tap"==u.tapEvent&&(s.body.on("click","a",function(e){return e.preventDefault(),!1}),s.body.on("tap","a",function(){Core.Event.trigger("redirect",this.href)})),$.os.android&&/Chrome/i.test(window.navigator.userAgent)&&s.body.on("touchstart","* [data-fix-active]",function(e){e.preventDefault()}),s.body.on(u.tapEvent,"* [data-fake-link]",function(){Core.Event.trigger("redirect",this.getAttribute("data-fake-link"))}),s.body.on("tap"==u.tapEvent?"touchstart":u.tapEvent,"* [data-analytics]",function(){Core.Event.trigger(this.getAttribute("data-analytics-global")?"analytics":"analyticsCurView",this.getAttribute("data-analytics"))}),s.body.on(u.tapEvent,"* [data-eventname]",function(){var e=this.getAttribute("data-eventname"),t=this.getAttribute("data-eventparam")||"",n=this.getAttribute("data-eventparams")||"";if(e){var o=[];o.push(e),n?Array.prototype.push.apply(o,n.split(",")):t&&o.push(t),Core.Event.trigger.apply(null,o)}})}function r(e,t,o,i){WechatShare({appid:"",img_url:i||n.dejaShareLogo,img_width:"200",img_height:"200",link:o||window.location.href,url:o||window.location.href,desc:t||document.title,content:t||document.title,title:e||document.title})}function a(e,t){YiXinShare({content:e||document.title,img:t||n.dejaShareLogo})}this.models={Basic:o};var s,u=this;Core.localParam(),Core.NativeBridge.isApp();this.tapEvent="click",this.getEls=function(){return s},this.getView=function(e){return s.views.filter("."+e)},this.getTemplates=function(e){var t=this.getView(e);if(t.$Templates)return t.$Templates;var n={};return t.find("*[data-template]").each(function(){var e=$(this),t=e.attr("data-template");t&&(n[t]=Core.microTmpl(e.text()))}),t.$Templates=n,n},this.show=function(e,t){this.hide(e);var n=this.getView(e);return!n.hasClass("show")&&n.addClass("show"),(void 0==t||t)&&(setTimeout(Core.Router.scrollToHistoryPosition,100),Core.Event.trigger("appModifyTitle")),this},this.hide=function(e){return(e?s.views.not("."+e):s.views).removeClass("show"),this},this.renderShare=function(e){return e=e||{},e.link=e.link||window.location.href,e.title=e.title||document.title,e.summary=e.summary||e.title,e.text=e.text||e.summary,e.thumburl=e.thumburl||n.dejaShareLogo,e.imageurl=e.imageurl||e.thumburl,Core.NativeBridge.set_data_for_share(e),r(e.title,e.summary,e.thumburl||e.imageurl),a(e.summary,e.thumburl||e.imageurl),this},this.lazyLoadImg=function(e){e&&setTimeout(function(){e.find("img").unveil(200,function(){this.onload=function(){/lazy/.test(this.className)&&(this.style.opacity=1)}})},0)},e()}var n=S,o=A;return new t}(R),D=function(e){var t=navigator.userAgent||navigator.platform;t=t.toLowerCase();var n=function(){function e(){return/ipad|iphone|ipod/gi.test(t)?"ios":t.match(/Android/gi)?"android":"desktop"}function n(){return/iphone os 9/gi.test(t)}function o(){return/fb/gi.test(t)}function i(){return/micromessenger/gi.test(t)}function r(){return/qqbrowser/gi.test(t)}function a(){return"wechat.html"}function s(e){var t=this.os();if(0==$(".tips").length){var n,o="<div class='tips'><h3>";n=e?e:"ios"===t?"click 'Open with Safari' <br> to watch videos.":"click 'Open with Browser'<br> to watch videos.",o+=n,o+="</h3></div>",$("body").append(o)}$(".tips").show().click(function(){$(this).hide()})}function u(){return 90===Math.abs(window.orientation)}return{os:e,ios9plus:n,wechat:i,fb:o,qq:r,mask:s,landscape:u,wechatRedirect:a}}();return n}(D),O=function(e){var t=D,n=function(){function e(e){if(0==arguments.length)return null;var t=Array.prototype.slice.call(arguments,1);return e.replace(/\{(\d+)\}/g,function(e,n){return t[n]})}function o(e){var t=null==e||""==e?"No title":e;return t=t.replace(/<(?:.|\n)*?>/gm,""),t.length>25&&(t=t.substr(0,25)+"..."),t}function i(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var i=n[o];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}function r(e,t,n){var o="; path=/";if(void 0!==n){var i=new Date,r=-i.getTimezoneOffset()/60;i.setTime(+i+60*(n+r)*60*1e3),o="; expires="+i.toUTCString()+"; path=/"}return document.cookie=e+"="+t+o,t}function a(e,t){void 0!==n.getCookie(e)&&"true"===n.getCookie(e)?console.log("done in 24 hours"):(t(e),n.setCookie(e,!0,24))}function s(e){document.cookie=e+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function u(e,t){var n=new Date-e-t;return n/=6e4,n>1?(n/=60,n>1?(n/=24,n>1?(n/=30,n>1?(n/=12,n>1?Math.ceil(n)+" years":Math.ceil(12*n)+" months"):Math.ceil(30*n)+" days"):Math.ceil(24*n)+" hours"):Math.ceil(60*n)+" minutes"):"1 minute"}function l(e){var t=new Date(e),n=t.getTimezoneOffset()/60;t.setTime(+t-60*n*60*1e3);var o=t.toString(),i=o.substring(15,21),r=o.substring(0,15),a=[r.substr(0,4),r.substr(8,3),r.substr(4,4),r.substr(11,5)];return r=a.join(""),r=r.replace(" ",", "),r=r.replace("Sun","Sunday"),r=r.replace("Mon","Monday"),r=r.replace("Tue","Tuesday"),r=r.replace("Wed","Wednesday"),r=r.replace("Thu","Thursday"),r=r.replace("Fri","Friday"),r=r.replace("Sat","Saturday"),i+" "+r}function c(e){var t=new Date(e),n=t.getUTCHours(),o=t.getUTCMinutes();return n=10>n?"0"+n:n,o=10>o?"0"+o:o,n+":"+o}function d(e){var t=new Date(e),n=new Date,o=t.getTimezoneOffset()/60;t.setTime(+t+60*o*60*1e3),n.setTime(+n+60*o*60*1e3);var i=n.getUTCDate(),r=n.getUTCMonth()+1,a=t.toString(),s=a.substring(15,21),u=t.getDate(),l=t.getMonth()+1;if(r===l){if(i===u)return"Today "+s;if(i===u-1)return"Tomorrow "+s}return 10>u&&(u="0"+u),10>l&&(l="0"+l),l+"-"+u+" "+s}function f(e,t,n,o,i){var r="",a=location.href;switch(t=null!=t&&""!=t?encodeURIComponent(t):"",o=null!=o&&""!=o?encodeURIComponent(o):"",n=null!=n&&""!=n?encodeURIComponent(n):"",i=null!=i&&""!=i?encodeURIComponent(i):"",e){case"facebook":r="https://www.facebook.com/dialog/feed?app_id=923301921038914&redirect_uri="+encodeURIComponent(a)+"&picture="+n+"&name="+t+"&link="+o+"&description="+i+"&display=popup&show_error=yes";break;case"twitter":r=this.buffUrl("https://twitter.com/share?text={0}&via=RINGS.TV&url={1}",i,o);break;case"pintrest":r=this.buffUrl("http://pinterest.com/pin/create/button/?url={0}&description={1}&media={2}",o,i,n);break;case"wechat":r=this.buffUrl("http://pinterest.com/pin/create/button/?url={0}&description={1}&media={2}",o,i,n);break;case"google-plus":r=this.buffUrl("https://plus.google.com/share?title={0}&via=RING.TV&url={1}",i,o);break;case"ins":}return r}function h(e,t){sessionStorage.poster=e.coverUrl,sessionStorage.title=e.title,window.player=new Clappr.Player({source:e.url,parentId:"#player",width:"100%",height:"100%",poster:e.coverUrl,playbackNotSupportedMessage:"Please try on a different browser"})}function p(e){$("#modal-"+e).parent().removeClass("hide"),m()}function v(){var e=$(".modal").filter(":visible");g(),e.parent().addClass("hide")}function m(){C.addClass("unscrollable"),x.addClass("unscrollable")}function g(){C.removeClass("unscrollable"),x.removeClass("unscrollable")}function w(){return"ios"===b?"https://itunes.apple.com/us/app/rings-interactive-broadcasting/id1011210996?mt=8":"https://play.google.com/store/apps/details?id=mozat.rings"}function y(){function e(){var e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,o=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&n]+t[n>>8&255]+"-"+t[n>>16&15|64]+t[n>>24&255]+"-"+t[63&o|128]+t[o>>8&255]+"-"+t[o>>16&255]+t[o>>24&255]+t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]}for(var t=[],n=0;256>n;n++)t[n]=(16>n?"0":"")+n.toString(16);return e()}var b=t.os(),C=$("body"),x=$("html");return{buffUrl:e,checkTitle:o,getCookie:i,setCookie:r,delCookie:s,daily:a,calEndTime:u,timestampToUTC:l,timestampToHMDM:d,timestampToHHMM:c,getShareUrl:f,clappr:h,openModal:p,closeModal:v,disableScroll:m,enableScroll:g,downloadLink:w,guid:y}}();return n}(O),I=function(e){var t=O,n=D,o=function(){function e(){var e={event:"wr.ch.play",type:bLive?"live":"replay",ch:sessionStorage.cid,sid:sessionStorage.sid,isLogin:h?1:0,uid:h||p};bLive||(e.vid=sessionStorage.mid),sessionStorage.firstPlay&&(sessionStorage.firstPlay=!1,f(e))}function o(){var e={event:"wr.ch.view",ch:sessionStorage.cid,sid:sessionStorage.sid,uid:h||p,type:bLive?"live":"replay",f:bLive?"live":"replay",isLogin:h?1:0};bLive||(e.vid=sessionStorage.mid),document.referrer&&-1!==document.referrer.indexOf("rings")||(e.f="share"),f(e)}function i(e){var t={event:"wr.follow",f:e,target_id:sessionStorage.hid,uid:h||p};f(t)}function r(){var e={event:"wr.ch.chat",ch:sessionStorage.cid,sid:sessionStorage.sid,uid:h||p};f(e)}function a(e){var t={event:"wr.download",f:e,platform:v,uid:h||p};f(t)}function s(e){var t={event:"wr.home."+e,hsa_live:sessionStorage.haslive};f(t)}function u(e){var t={event:"wr.event.register",eid:e,uid:h||p};f(t)}function l(e){var t={event:"wr.share",f:bLive?"live":"replay",ch:sessionStorage.cid,sid:sessionStorage.sid,uid:h||p};e&&(t.vid=e),f(t)}function c(e,t){var n={event:"wr.login",uid:h||p,f:e,channel:t};f(n)}function d(){var e={uid:h,event:"wr.drawer.logout"};f(e)}function f(e){if(e){var t=document.createElement("img"),n="http://rings.me/download.php?";e.r=Math.random();var o=$.param(e);t.src=n+o,t.onload=function(){console.log("sendLog: ",n)}}}var h=t.getCookie("userID"),p=t.getCookie("_id"),v=(t.getCookie("token"),n.os());return{chPlay:e,chView:o,follow:i,chChat:r,download:a,homeTab:s,eventRegister:u,share:l,login:c,logout:d,sendLog:f}}();return o}(I),j=function(e){function t(){function e(){var e=Math.min(Math.min(window.pageYOffset,document.documentElement.scrollTop||document.body.scrollTop),window.scrollY),t=e,n=0,o=0,i=n-t,r=0,a=20,s=500;!function l(){return r+=a,2>t||u.views.Basic.GlobalTouch.touched||r>s?(2>t&&window.scrollTo(0,1),void cancelRequestAnimFrame(o)):(window.scrollTo(0,Math.easeInOutQuad(r,t,i,s)),void(o=requestAnimFrame(l)))}()}function t(){s()}function a(e,t,n){e&&(t=t||"animated",n=n||1200,e.animTimer&&clearTimeout(e.animTimer),e.addClass(t),e.animTimer=setTimeout(function(){e.removeClass(t)},n))}function s(e){e=e||document.title,document.title=e,l&&Core.NativeBridge.modifytitle(e)}this.models={Basic:n},this.views={Basic:o},Core.Router.onChanged(t);var u=this,l=Core.NativeBridge.isApp(),c=Core.localParam(),d=c.search.userId,f=(c.search.modal,c.search.token),h=(c.search.download,c.search.id);if(h||i.getCookie("_id")?h&&i.setCookie("_id",h):i.setCookie("_id",i.guid()),!i.getCookie("userID")&&d&&!i.getCookie("token")&&f&&(i.setCookie("userID",d,2),i.setCookie("token",f,2),i.setCookie("_id",h)),d){Core.Router.refine();var p=sessionStorage.typef,v=sessionStorage.diLoginChannel;r.login(p,v)}window.onpopstate=function(e){var t=$(".modal-mask").filter(":visible");t.addClass("hide")},Core.Event.on("trigerAnimate",a),Core.Event.on("scrollTop",e),Core.Event.on("back",function(e){Core.Router.back(e||-1)})}var n=A,o=R,i=O,r=I;return new t}(j),L=function(e){function t(){}var n,o=M,i=S,r=Core.Class.Model;Core.localStorage;return t.prototype.view=new r({request:function(e,t){o.request(i.User.view,e,t,this)}}),t.prototype.rename=new r({request:function(e,t){o.request(i.User.rename,e,t,this)}}),n=new t}(L),P=function(e){function t(){}var n,o=M,i=S,r=Core.Class.Model;return t.prototype.index=new r({request:function(e,t){o.request(i.Live.index,e,t,this)}}),t.prototype.view=new r({request:function(e,t){o.request(i.Live.view,e,t,this)}}),t.prototype.count=new r({request:function(e,t){o.request(i.Channel.count,e,t,this)}}),t.prototype.messages=new r({request:function(e,t){o.request(i.Live.messages,e,t,this)}}),n=new t}(P),_=function(e){function t(){}var n,o=M,i=S,r=Core.Class.Model;return t.prototype.index=new r({request:function(e,t){o.request(i.Replay.index,e,t,this)}}),t.prototype.view=new r({request:function(e,t){o.request(i.Replay.view,e,t,this)}}),t.prototype.owner=new r({request:function(e,t){o.request(i.Replay.owner,e,t,this)}}),t.prototype.tag=new r({request:function(e,t){o.request(i.Replay.tag,e,t,this)}}),t.prototype.count=new r({request:function(e,t){o.request(i.Channel.count,e,t,this)}}),n=new t}(_),q=function(e){function t(){}var n,o=M,i=S,r=Core.Class.Model;return t.prototype.index=new r({request:function(e,t){e.userId||(e.userId=1),o.request(i.Event.index,e,t,this)}}),t.prototype.view=new r({request:function(e,t){o.request(i.Event.view,e,t,this)}}),t.prototype.register=new r({request:function(e,t){o.request(i.Event.register,e,t,this)}}),t.prototype.unregister=new r({request:function(e,t){o.request(i.Event.unregister,e,t,this)}}),t.prototype.isFollowed=new r({request:function(e,t){o.request(i.Channel.isFollowed,e,t,this)}}),n=new t}(q),V=function(e){function t(){}var n,o=M,i=S,r=Core.Class.Model;return t.prototype.index=new r({request:function(e,t){o.request(i.Channel.index,e,t,this)}}),t.prototype.view=new r({request:function(e,t){o.request(i.Channel.view,e,t,this)}}),t.prototype.isFollowed=new r({request:function(e,t){o.request(i.Channel.isFollowed,e,t,this)}}),t.prototype.follow=new r({request:function(e,t){o.request(i.Channel.follow,e,t,this)}}),t.prototype.unfollow=new r({request:function(e,t){o.request(i.Channel.unfollow,e,t,this)}}),t.prototype.getViewerCount=new r({request:function(e,t){o.request(i.Channel.getViewerCount,e,t,this)}}),n=new t}(V),H=function(e){function t(){function e(){if(!O){var e=j._BasicView.getView(j.viewCls);O={main:e,promo:e.find(".app-block"),promoSup:e.find(".app-position-block"),menu:e.find("aside"),nav:e.find(".nav"),homePanels:e.find(".home-panels"),btnMenu:e.find(".btn-menu"),linkHome:e.find(".link-home"),linkDownload:e.find(".link-download"),menuProfile:e.find(".menu .header"),login:e.find(".login"),logout:e.find(".logout"),menuMask:e.find(".menu-mask"),panels:e.find(".panels"),tabs:e.find(".tabs"),liveTab:e.find("#live-tab"),livePanel:e.find("#live-panel"),eventPanel:e.find("#event-panel"),replayPanel:e.find("#replay-panel"),nolive:e.find("#live-panel .empty"),noevent:e.find("#event-panel .empty"),noreplay:e.find("#replay-panel .empty"),eventTab:e.find("#event-tab"),replayTab:e.find("#replay-tab"),lives:e.find(".lives"),events:e.find(".events"),replays:e.find(".replays"),player:e.find("#player"),iframe:e.find(".iframe")},h(),f(),v()}}function t(){D||(D=D||j._BasicView.getTemplates(j.viewCls))}function d(){t(),e()}function f(){q&&V&&(O.logout.removeClass("hide"),O.login.addClass("hide"))}function h(){var e=u.getCookie("promo");e&&(O.promo.addClass("hide"),O.promoSup.addClass("hide"),O.homePanels.addClass("padding"),O.nav.addClass("fixed"),O.tabs.addClass("fixed"))}function p(){O.promo.on(_,".close",function(){O.promo.addClass("hide"),O.promoSup.addClass("hide"),O.homePanels.addClass("padding"),O.nav.addClass("fixed"),O.tabs.addClass("fixed"),u.setCookie("promo",!0,24)})}function v(){g(),p(),k(),w(),R=document.querySelector(".on .pull-refresh"),O.tabs.on(_,".tab",function(){var e=$(this);if(!e.hasClass("on")){O.tabs.find(".on").removeClass("on"),e.addClass("on");var t,n=e.data("link");t=-1!=n.indexOf("event")?"up_coming":-1!=n.indexOf("replay")?"replay":"live",l.homeTab(t),O.panels.find(".on").removeClass("on"),O.panels.find("#"+n).addClass("on"),R=document.querySelector(".on .pull-refresh")}}),O.lives.on(_,".live-box",function(){var e=$(this),t=e.prev().find(".watch-count"),n=parseInt(t.text())+1;t.text(n+" watching");var o=e.data("cid");sessionStorage.poster=e.data("cover"),sessionStorage.title=e.data("title"),Core.Router.forward("/video/cid="+o)}),O.events.on(_,".event-box",function(e){var t=$(this),n=t.data("eid"),o=t.data("uid");$(e.target).is(".host, .host *")||Core.Router.forward("/event/eid="+n+"&hid="+o)}).on(_,".host",function(e){if(!$(e.target).is(".act-reg")){var t=$(this),n=t.data("uid");console.log("view profile uid: "+n)}}),O.replays.on(_,".replay-box",function(){var e=$(this),t=e.prev().find(".watch-count"),n=parseInt(t.text())+1;t.text(n+" watched");var o=e.data("mid");sessionStorage.poster=e.data("cover"),sessionStorage.title=e.data("title"),Core.Router.forward("/video/mid="+o)}),O.panels.on(_,".profile",function(){var e=$(this).data("uid");console.log("view profile: "+e)}),O.events.on(_,".act-reg",function(){var e=$(this),t=e.hasClass("btn-hollow"),n=e.data("eid"),o=e.parents(".event-item").find(".count"),i=parseInt(o.text());return q?(t?(e.text("Register"),o.text(i-1),M(n,!0)):(e.text("Registered"),o.text(i+1),M(n,!1)),void e.toggleClass("btn-solid btn-hollow")):void u.openModal("login")}),O.logout.on(_,function(){l.logout(),u.delCookie("userID"),u.delCookie("token"),location.reload()})}function m(e){H=setInterval(function(){if(D&&D.MenuProfile){console.log("checking menuProfile"),e=e||j.models.User.view.get().profile,!e&&console.log("empty profile");var t=[];t.push(D.MenuProfile(e)),O.menuProfile.html("").append(t.join("")),clearInterval(H)}},1e3)}function g(){O.linkHome.on(_,function(){O.menu.hasClass("popup")&&(O.menu.addClass("closeup").removeClass("popup"),O.menuMask.addClass("hide"),u.enableScroll()),Core.Router.forward("/home/")}),O.btnMenu.on(_,function(){O.menu.addClass("popup").removeClass("closeup hide"),O.menuMask.removeClass("hide"),u.disableScroll()}),O.menuMask.on(_,function(){O.menu.addClass("closeup").removeClass("popup"),setTimeout(function(){O.menu.addClass("hide")},600),O.menuMask.addClass("hide"),u.enableScroll()}),O.login.on(_,function(){q&&V||(sessionStorage.typef="drawer",u.openModal("login"))}),O.menu.on(_,".edit-name",function(){q?u.openModal("rename"):u.openModal("login")})}function w(){document.addEventListener("touchstart",y,!1),document.addEventListener("touchmove",b,!1),document.addEventListener("touchend",C,!1)}function y(e){O&&O.main.hasClass("show")&&(B=e.touches[0].clientX,F=e.touches[0].clientY)}function b(e){if(O&&O.main.hasClass("show")&&B&&F&&"android"!=c.os()){var t=e.touches[0].clientX,n=e.touches[0].clientY;U=B-t,z=F-n,Math.abs(U)>Math.abs(z)?U>0?O.menuMask.click():200>=B&&-200>U&&O.btnMenu.click():z>0||0>z&&window.scrollY<=1&&(J=!0)}}function C(){if(O&&O.main.hasClass("show")&&J){var e=R.id;-G>=z&&(window.rerender=!0,J=!1,sessionStorage[e]=10,j.models[e].index.request({limit:10,userId:q},x)),U=z=0}}function x(){console.log("updated")}function k(){$(window).on("scroll.home",function(){if(I){var e=O.panels.height();if("ios"===c.os()&&90===Math.abs(window.orientation)&&(e/=2),$(window).scrollTop()+$(window).height()+120>=e)if(O.liveTab.hasClass("on")){if(window.noMoreLive)return;T("Live")}else if(O.eventTab.hasClass("on")){if(window.noMoreEvent)return;T("Event")}else{if(window.noMoreReplay)return;T("Replay")}}})}function T(e){sessionStorage[e]=parseInt(sessionStorage[e])+P,j.models[e].index.request({offset:sessionStorage[e],limit:P})}function E(e){e=e||j.models.Live.index.get()["live-videos"];var t=[];e?(window.hasLive=!0,O.nolive.addClass("hide"),e.forEach(function(e){t.push(D.LiveItem(e))})):window.hasLive?(window.noMoreLive=!0,O.nolive.addClass("hide")):O.nolive.removeClass("hide"),window.rerender?(O.lives.html(t.join("")),window.rerender=!1):O.lives.append(t.join(""))}function S(e){e=e||j.models.Event.index.get().events;var t=[];e?(window.hasEvent=!0,e.forEach(function(e){e.viewTime=u.timestampToHMDM(1e3*e.beginTime),t.push(D.EventItem(e))})):window.hasEvent?(window.noMoreEvent=!0,O.noevent.addClass("hide")):O.noevent.removeClass("hide"),window.rerender?(window.rerender=!1,O.events.html(t.join(""))):O.events.append(t.join(""))}function N(e){e=e||j.models.Replay.index.get()["replay-videos"];var t=[];e?(window.hasReplay=!0,e.forEach(function(e){e.recordedDate=u.timestampToHMDM(e.recordedTime),t.push(D.ReplayItem(e))})):window.hasReplay?(window.noMoreReplay=!0,O.noreplay.addClass("hide")):O.noreplay.removeClass("hide"),window.rerender?(window.rerender=!1,O.replays.html(t.join(""))):O.replays.append(t.join(""))}function M(e,t){var n={eid:e,uid:q,token:V};t?j.models.Event.unregister.request(n):(j.models.Event.register.request(n,A),u.daily("getApp",u.openModal))}function A(){j.models.Event.register.get()}this.models={User:o,Live:i,Replay:r,Event:a,Channel:s},this.viewCls="view-home",this._BasicView=n;var R,D,O,I,j=this,L={},P=5,_=j._BasicView.tapEvent,q=u.getCookie("userID"),V=u.getCookie("token");sessionStorage.Live=sessionStorage.Event=sessionStorage.Replay=0,j.models.Live.index.updated(E),j.models.Event.index.updated(S),j.models.Replay.index.updated(N),q&&V&&m(),this.getEls=function(){return e(),O},this.getTpls=function(){return t(),D};var H;this.show=function(){I=!0,d(),O.main.hasClass("show")||(Core.Event.trigger("trigerAnimate",O.main),j._BasicView.show(j.viewCls)),"replay"===L.tab?O.replayTab.click():"event"===L.tab&&O.eventTab.click()};var B=null,F=null,U=0,z=0,G=50,J=!1;this.hide=function(){O&&(I=!1)}}var n=R,o=L,i=P,r=_,a=q,s=V,u=O,l=I,c=D;return new t}(H),B=function(e){function t(){function e(){t()}function t(){h.views.Home.hide()}function c(e){d(e)}function d(e){p=e.query,f(p.tab),h.views.Home.show()}function f(){return window.triggered?void console.log("triggered"):(window.triggered=!0,h.models.Live.index.request({limit:10}),h.models.Event.index.request({limit:10,userId:v}),void h.models.Replay.index.request({limit:10}))}this.models={Live:o,Replay:i,Event:r,Channel:a,User:n},this.views={Basic:s,Home:u};var h=this,p={},v=l.getCookie("userID"),m=l.getCookie("token");v&&h.models.User.view.request({userID:v,token:m}),Core.Router.onUnsubscribed(c,e).subscribe("/home/",d,t)}var n=L,o=P,i=_,r=q,a=V,s=R,u=H,l=O;return new t}(B),F=function(e){function t(){}var n,o=M,i=S,r=Core.Class.Model;return t.prototype.isPrivate=new r({request:function(e,t){o.request(i.Eventinfo.isPrivate,e,t,this)}}),n=new t}(F),U=function(e){var t=S,n=I,o=function(){function e(e,t,n,i,r,a,s){u=e,l=t,c=n,d=i,f=r,h=a,p=s,v=window.ws,setTimeout(function(){1!=v&&o()},1e3)}function o(){null!=u&&(i(),s(h,l,d,c))}function i(){if(!u)return void console.log("illegal chatting room server url");var e=u+"?userID="+l+"&token="+c+"&roomID="+d;window.ws=new WebSocket(e),ws.onopen=function(e){v=!0,console.log("Connected to "+u+" channel: "+d+" done.")},ws.onerror=function(e){console.log("An error occurred"),v=!1},ws.onmessage=function(e){var t=e.data;r(t)},ws.onclose=function(){console.log("ws closed")}}function r(e){if(null!=e&&""!=e){var t=null;try{t=$.parseJSON(e)}catch(n){return void console.log("illegal message json")}t.isGift&&null!=t.itemId&&(t.itemId.endsWith("-png")&&(t.itemId+=".png"),
t.itemId.endsWith("-gif")&&(t.itemId+=".gif"),t.itemId.indexOf("-spe-")>0&&(t.itemId+=".png"));var o=p(t);f.append(o),a(f)}}function a(e){0!=e.length&&(e.get(0).scrollTop=e.get(0).scrollHeight)}function s(e,o,i,r){e.on("keypress",function(a){if(13==a.which){a.preventDefault();var s;s=1===o?t.host+"/audience/anonymous-user-send-text-message":t.host+"/channel/send-text-message",n.chChat();var u=$.trim(e.val());if(""==u||null==i)return;if(o){var l={channelID:i,content:u,userID:o,token:r};$.get(s,l,function(e){},"json"),e.val("")}}})}var u,l,c,d,f,h,p,v=!1;return{connect:e}}();return o}(U),z=function(e){function t(){function e(){if(!V){var e=H._BasicView.getView(H.viewCls);V={main:e,videoArea:e.find(".video-area"),chatArea:e.find(".chat-area"),replayArea:e.find(".replay-area"),chatBoxes:e.find(".chat-boxes"),replayBoxes:e.find(".replay-boxes"),videoBox:e.find(".video-box"),infoBox:e.find(".info-box"),videoHeader:e.find(".video-header"),tpHostAvatar:e.find("#host-avatar"),videoPlayer:e.find(".video-player"),videoFooter:e.find(".video-footer"),player:e.find("#player"),ctrl:e.find("#control"),fullCtrl:e.find("#full"),inputChat:e.find("#act-chat"),tpHostInfo:e.find("#host-info"),tpVideoInfo:e.find("#video-info"),actShare:e.find(".act-share"),actFull:e.find(".act-full"),actClose:e.find(".act-close"),actApp:e.find(".act-app"),actChat:e.find("#act-chat"),chatMask:e.find(".chat-mask"),loadMask:e.find(".load-mask"),poor:e.find(".poor"),ended:e.find("#ended")},h()}}function t(){console.log("reload executed"),ee=ee||$(".load-mask"),ee.removeClass("hide"),sessionStorage.poster&&ee.find(".cover").css("background-image","url("+sessionStorage.poster+")"),setTimeout(function(){f(ee)},600)}function f(e){navigator.onLine?e.addClass("hide"):e.find(".poor").removeClass("hide")}function h(){V.replayBoxes.on(F,".replay-box",function(){var e=$(this),n=e.data("mid");window.scrollTo(0,0),n!==B.mid&&(sessionStorage.poster=e.data("cover"),t(),Core.Router.forward("/video/mid="+n))}),V.main.on(F,".act-follow",function(){var e,t,n=$(this),o=V.main.find(".js-follow-count");if(n.hasClass("host")?(t=n,e=V.replayArea.find(".act-follow")):(t=V.videoArea.find(".act-follow"),e=n),0===U.length)sessionStorage.typef="follow",s.openModal("login");else{var i,r,a="Following"===e.text(),l=n.data("cid");a?(H.models.Channel.unfollow.request({uid:U,cid:l,token:z}),i=parseInt(o.text())-1,r="Follow"):(u.follow("up_coming"),H.models.Channel.follow.request({uid:U,cid:l,token:z}),i=parseInt(o.text())+1,r="Following",s.daily("getApp",s.openModal)),o&&o.text(i),e.html(r).toggleClass("btn-hollow btn-solid"),t.toggleClass("followed")}}),V.actApp.on(F,function(){s.openModal("getAppGift")}),V.actShare.on(F,function(){s.openModal("share")}),V.actClose.on(F,function(){!window.player||window.player instanceof HTMLElement||player.stop(),window.ws&&(ws.close(),ws=null),Core.Router.forward("/home/")}),V.chatMask.on(F,function(){s.openModal("getAppGift")}),player&&V.ended.hide(),v(),m(),g(),p()}function p(){setTimeout(function(){var e=$(".marquee"),t=e.width();if(t>595){t+=50,console.log("marquee");var n=e.clone(),o="<style>@keyframes mmarquee {from{transform: translateX(0)}to{transform:translateX(-"+t+"px)}}</style>";e.after(n).before(o)}},1500)}function v(){$(window).on("scroll.replays",function(){if(V.main.hasClass("show")){var e=V.replayBoxes.height();"ios"===Y&&l.landscape()&&(e/=2),!bLive&&$(window).scrollTop()+520>=e&&N("more")}})}function m(){V.fullCtrl.on(F,function(){var e=V.player.find(".media-control");V.videoHeader.hasClass("hidden")?(V.videoHeader.removeClass("hidden"),V.videoFooter.removeClass("hidden"),e.removeClass("hidden")):(V.videoHeader.addClass("hidden"),V.videoFooter.addClass("hidden"),e.addClass("hidden"))}),V.ctrl.on(F,function(){bLive?(console.log("live ctrl"),player.isPlaying()?player.stop():player.play()):(console.log("replay ctrl"),player.isPlaying()?player.pause():player.play())})}function g(){V.actFull.on(F,function(){var e=$(this),t=V.player.find(".media-control");s.disableScroll(),!V.videoArea.hasClass("full")&&player&&player.play(),window.scrollTo(0,0),V.videoArea.toggleClass("full"),e.toggleClass("icon-full icon-exit-full"),V.ctrl.toggleClass("hide"),V.fullCtrl.toggleClass("hide"),V.videoHeader.hasClass("hidden")&&(V.videoHeader.removeClass("hidden"),V.videoFooter.removeClass("hidden"),t.removeClass("hidden")),V.player.find(".poster-icon").toggleClass("hide")})}function w(){q||(q=q||H._BasicView.getTemplates(H.viewCls))}function y(){e(),w()}function b(e){return e=H.models.Live.view.get().data,e&&e.video?(bLive=!0,V.ended.hide(),V.replayArea.addClass("hide"),V.chatArea.removeClass("hide"),void x(!0,e,T)):(console.log("no live!"),void A())}function C(e){return bLive=!1,(e=H.models.Replay.view.get().data)?(x(!1,e,T),V.chatArea.addClass("hide"),void V.replayArea.removeClass("hide")):(console.log("no replay!"),void E())}function x(e,t,n){return"Android"===Y&&(l.fb()||l.wechat())?void l.mask("To watch video, open in Browser or Chrome."):void k(n)}function k(e){H.models.Eventinfo.isPrivate.request({userID:U||1,token:z||"mobile",channelID:G,sessionID:W},e)}function T(){console.log("video render live state: "+bLive);var e=bLive?H.models.Live.view.get().data:H.models.Replay.view.get().data;if(V.ended.hide(),bLive){if(!e)return void A();V.replayArea.addClass("hide"),V.chatArea.removeClass("hide")}O(e),E(e,!0);var t=H.models.Eventinfo.isPrivate.get();console.log("isPrivate: "+t),t?(V.videoPlayer.addClass("invisible"),V.player.empty(),window.player=null,s.openModal("private")):(bLive&&!window.ws&&S(),V.player.empty(),window.player=null,s.clappr(e.video,bLive),V.player.find("video").attr("webkit-playsinline",!0),I(e)),R(),u.chView()}function E(e,t){if(t){if(!e)return void A();e.bLive=bLive}else e=bLive?H.models.Live.view.get().data:H.models.Replay.view.get().data;V.videoHeader.find(".avatar-follow").html(q.HostAvatar(e),!0),V.tpHostInfo.html(q.Host(e),!0),V.tpVideoInfo.html(q.Info(e),!0)}function S(){V.chatBoxes.html(""),H.models.Live.messages.request({uid:U||100,token:z||"233",cid:G,count:50},M),c.connect(K,U||1,z,B.cid,V.chatBoxes,V.inputChat,q.Chat)}function N(e){e&&"more"===e||(V.replayBoxes.html(""),Z=0),X=H.models.Replay.owner.get();var t=[],n=0;if(X&&X.length>0){if(Z==X.length)return;for(Z;Q>n;Z++){var o=X[Z];if(!o)break;o.recordedDate=s.timestampToHMDM(o.recordedTime),t.push(q.Replay(o)),n++}V.replayBoxes.append(t.join(""))}}function M(){var e=H.models.Live.messages.get().messages;console.log(e);for(var t=[],n=e.length-1;n>=0;n--)t.push(q.Chat(e[n]));V.chatBoxes.append(t.join("")),V.chatBoxes.get(0).scrollTop=V.chatBoxes.get(0).scrollHeight}function A(){bLive=!1,V.ended.show(),console.log("no live, render end"),H.models.Channel.view.request({id:B.cid},D),V.replayArea.removeClass("hide"),V.chatArea.addClass("hide"),V.player.empty(),window.player=null,window.ws&&(ws.onclose=function(){},ws.close(),console.log("ws close"))}function R(){l.wechat()&&"ios"!==Y&&l.mask()}function D(){var e=H.models.Channel.view.get();e.video.end="true",V.videoHeader.find(".avatar-follow").html(q.HostAvatar(e),!0),V.tpVideoInfo.html(q.Info(e),!0),V.tpHostInfo.html(q.Host(e),!0),H.models.Channel.isFollowed.request({hid:e.host.id,uid:U}),H.models.Replay.owner.request({hid:e.host.id})}function O(e){G=sessionStorage.cid=e.video.channelID,J=sessionStorage.hid=e.host.id,W=sessionStorage.sid=e.video.sessionID,B.mid&&(sessionStorage.mid=B.mid),sessionStorage.hoster=e.host.name,sessionStorage.hostAvatar=e.host.avatar,sessionStorage.followerCount=e.host.followerCount,sessionStorage.videoCount=e.host.videoCount,sessionStorage.title=e.video.title,sessionStorage.watchedCount=e.video.watchedCount,sessionStorage.firstPlay=!0,sessionStorage.poster=e.video.coverUrl}function I(e){var n=!1;player.on(Clappr.Events.PLAYER_PLAY,function(){0===e.video.seekStart||n||(player.seek(e.video.seekStart),n=!0),console.log(e.video.seekStart),bLive?V.player.find(".media-control").addClass("live"):V.player.find(".media-control").removeClass("live"),console.log("player start: watch count interval"),P(),u.chPlay()}),player.on(Clappr.Events.PLAYER_PAUSE,function(){console.log("player pause: stop watch count interval"),clearInterval(te)}),player.on(Clappr.Events.PLAYER_ERROR,function(e){clearInterval(te),console.log("error code:"+e.error.code),2==e.error.code?navigator.onLine?A():t():s.openModal("getApp")}),player.on(Clappr.Events.PLAYER_ENDED,function(){console.log("player stop: stop watch count interval"),clearInterval(te),s.daily("getApp",s.openModal)})}function j(e){B=e.query}function L(){setTimeout(function(){var e=H.models.Channel.isFollowed.get().followed,t=V.replayArea.find(".act-follow"),n=V.videoArea.find(".act-follow");e?(t.toggleClass("btn-solid btn-hollow").text("Following"),n.addClass("followed")):(t.text("Follow"),n.removeClass("followed"))},100)}function P(e){var t=B.mid,n=B.cid;te=setInterval(function(){t?H.models.Replay.count.request({mid:t}):n&&H.models.Live.count.request({id:n}),console.log("interval req")},e||15e3)}function _(){var e=V.infoBox.find(".watch-count"),t=bLive?H.models.Live.count.get().count:H.models.Replay.count.get().count;e.text(t)}this.models={Live:i,Replay:r,Channel:o,Eventinfo:a},this.viewCls="view-video",this._BasicView=n,window.bLive=!1;var q,V,H=this,B={},F=H._BasicView.tapEvent,U=s.getCookie("userID"),z=s.getCookie("token"),G=sessionStorage.cid,J=sessionStorage.hid,W=sessionStorage.sid,Y=l.os(),X=null,Z=0,Q=5,K=d.chatRoom;Core.Router.subscribe("/video/",j),H.models.Live.view.updated(b),H.models.Live.count.updated(_),H.models.Replay.count.updated(_),H.models.Replay.view.updated(C),H.models.Replay.owner.updated(N),H.models.Channel.isFollowed.updated(L);var ee;this.show=function(){t(),y(),H._BasicView.show(H.viewCls)},this.hide=function(){};var te}var n=R,o=V,i=P,r=_,a=F,s=O,u=I,l=D,c=U,d=S;return new t}(z),G=function(e){function t(){function e(){s.enableScroll(),!window.player||window.player instanceof HTMLElement||window.player.stop(),f.views.Video.hide(),window.ws&&(window.ws.close(),window.ws=null)}function t(e){h=e.query,f.views.Video.show(),u()}function u(){var e=h.cid,t=h.mid;e?f.models.Live.view.request({id:e,count:1},l):t?f.models.Replay.view.request({id:t,count:1},c):Core.Router.forward("/home/")}function l(){var e,t=f.models.Live.view.get().data;t?(bLive=!0,e=t.host.id):e=sessionStorage.hid,window.uncountFollow=!0,f.models.Channel.isFollowed.request({hid:e,uid:p}),f.models.Replay.owner.request({hid:e})}function c(){var e=f.models.Replay.view.get().data,t=e.host.id;window.uncountFollow=!0,f.models.Channel.isFollowed.request({hid:t,uid:p}),f.models.Replay.owner.request({hid:t})}function d(e){Core.Router.forward("/video/"+(e||""))}this.models={Live:n,Channel:o,Replay:i},this.views={Basic:r,Video:a};var f=this,h={},p=s.getCookie("userID");s.getCookie("token");Core.Router.subscribe("/video/",t,e),Core.Event.on("forwardVideo",d)}var n=P,o=V,i=_,r=R,a=z,s=O;return new t}(G),J=function(e){function t(){function e(){if(!w){var e=k._BasicView.getView(k.viewCls);w={main:e,eventContainer:e.find("#event-wrapper"),actBack:e.find(".act-back")},y=T.eid,b=$('.events .event-box[data-eid="'+y+'"]'),l()}}function t(){g||(g=g||k._BasicView.getTemplates(k.viewCls))}function u(){e(),t()}function l(){d(),f(),c()}function c(){w.actBack.on(E,function(){Core.Router.back()})}function d(){w.main.on(E,".act-follow",function(){var e=$(this);if(x=w.main.find(".js-follow-count"),0===S.length)sessionStorage.typef="follow",a.openModal("login");else{var t,n,o=-1!==e.html().indexOf("Following"),i=e.data("cid");o?(k.models.Channel.unfollow.request({uid:S,cid:i,token:N}),t=parseInt(x.text())-1,n="Follow"):(s.follow("up_coming"),k.models.Channel.follow.request({uid:S,cid:i,token:N}),t=parseInt(x.text())+1,n="Following",a.daily("getApp",a.openModal)),x.text(t),e.text(n).toggleClass("btn-hollow btn-solid")}})}function f(){w.main.on(E,".act-reg",function(){var e=$(this);if(C=w.main.find(".js-register-count"),0===S.length)sessionStorage.typef="follow",a.openModal("login");else{var t,n=-1!==e.html().indexOf("Registered"),o=b.find(".act-reg"),i=b.next().find(".count");console.log(o),y=T.eid,n?(k.models.Event.unregister.request({uid:S,eid:y,token:N}),e.html("Register").toggleClass("btn-hollow btn-solid"),o.html("Register").toggleClass("btn-hollow btn-solid"),t=parseInt(C.text())-1):(s.eventRegister(y),k.models.Event.register.request({uid:S,eid:y,token:N},h),e.html("Registered").toggleClass("btn-hollow btn-solid"),o.html("Registered").toggleClass("btn-hollow btn-solid"),a.daily("getApp",a.openModal),t=parseInt(C.text())+1),C.html(t),i.html(t)}})}function h(){var e=k.models.Event.register.get();console.log("after register:"),console.info(e)}function p(e){e=e||k.models.Event.view.get().data[0],e||console.error("no event data");var t=[];e.viewTime=a.timestampToHHMM(1e3*e.beginTime),console.log(e.description),e.description=e.description.replace(/\n/g,"<br>"),t.push(g.EventInfo(e)),w.eventContainer.html("").append(t.join(""))}function v(e){T=e.query}function m(){setTimeout(function(){var e=k.models.Event.isFollowed.get().followed,t=w.eventContainer.find(".act-follow");e&&t.toggleClass("btn-solid btn-hollow").text("Following")},100)}this.models={Basic:o,Event:i,Channel:r},this.viewCls="view-event",this._BasicView=n;var g,w,y,b,C,x,k=this,T=(Core.NativeBridge.isApp(),{}),E=k._BasicView.tapEvent,S=a.getCookie("userID"),N=a.getCookie("token");Core.Router.subscribe("/event/",v),k.models.Event.view.updated(p),k.models.Event.isFollowed.updated(m),this.show=function(){u(),Core.Event.trigger("trigerAnimate",w.main),k._BasicView.show(k.viewCls)},this.hide=function(){}}var n=R,o=A,i=q,r=V,a=O,s=I;return new t}(J),W=function(e){function t(){function e(){l.views.Event.hide()}function t(e){c="event",d=e.query,l.views.Event.show(),u()}function s(e){Core.Router.forward("/event/"+(e||""))}function u(){var e=d.eid,t=d.hid;if(e){var n=f||1;l.models.Event.view.request({eid:e,uid:n}),l.models.Event.isFollowed.request({hid:t,uid:f})}else Core.Router.forward("/home/")}this.models={Basic:n,Event:r},this.views={Basic:o,Event:i};var l=this,c="",d={},f=a.getCookie("userID");a.getCookie("token");Core.Router.subscribe("/event/",t,e),Core.Event.on("forwardEvent",s)}var n=A,o=R,i=J,r=q,a=O;return new t}(W),Y=function(e){var t=O,n=function(){function e(e,n){var o=t.buffUrl('<iframe src="ringsmozat://broadcast/openVideo?cid={0}&sid={1}"></iframe>',e,n);return console.log(o),o}function n(e,n,o){var i;return console.log(t.osDetect()),i="ios"===t.osDetect()?t.buffUrl('<iframe src="ringsmozat://account/viewProfile?uid={0}&cid={1}&sid={2}"></iframe>',e,n,o):t.buffUrl('<iframe src="ringsmozat://account/viewProfile?uid={0}"></iframe>',e),console.log(i),i}function o(e){var n=t.buffUrl('<iframe src="ringsmozat://broadcast/openReplay?mid={0}"></iframe>',e);return console.log(n),n}function i(e,n){var o='<iframe src="mozatrings://';return e&&n&&(o+=t.buffUrl('video/{0}/{1}"',e,n)),o+='"></iframe>',console.log(o),o}return{openVideo:e,openReplay:o,viewProfile:n,openAppVideo:i}}();return n}(Y),X=function(e){function t(){function e(){if(!w){var e=b._BasicView.getView(b.viewCls);w={main:e,login:e.find("#modal-login"),rename:e.find("#modal-rename"),share:e.find("#modal-share"),getapp:e.find("#modal-getApp"),"private":e.find("#modal-private"),modal:e.find(".modal"),modalMask:e.find(".modal-mask"),authMask:e.find(".auth-mask"),fbLogin:e.find("#fb-login"),twLogin:e.find("#tw-login"),gpLogin:e.find("#go-login"),btnClose:e.find(".btn-close"),btnRename:e.find(".btn-save"),inputRename:e.find("#rename"),jsback:e.find(".js-back"),modals:e.find(".modal"),iframe:e.find(".iframe")},d()}}function t(){g||(g=g||b._BasicView.getTemplates(b.viewCls))}function c(){e(),t()}function d(){p(),f(),w.modalMask.on(x,function(e){$(e.target).is(".modal,.modal *")||r.closeModal()}),w.btnRename.on(x,function(){var e=w.inputRename.val();return e?(b.models.User.rename.request({userID:k,name:e,token:T}),r.closeModal(),e=r.checkTitle(e),$("aside .user-name").text(e),void w.inputRename.removeClass("error").text("")):void w.inputRename.addClass("error")}),w.jsback.on(x,function(e){$(e.target).is(".modal, .modal *")||Core.Router.back()}),w.btnClose.on(x,function(){r.closeModal()})}function f(){w.fbLogin.on(x,function(){sessionStorage.diLoginChannel="facebook",h("facebook")}),w.twLogin.on(x,function(){sessionStorage.diLoginChannel="twitter",h("twitter")}),w.gpLogin.on(x,function(){sessionStorage.diLoginChannel="google",h("google")})}function h(e){var t=$(".load-mask");t.removeClass("hide"),setTimeout(function(){t.addClass("hide")},5e3),location.href=l.host+"/account/auth?authclient="+e}function p(){var e=r.downloadLink();y=$("body"),y.on(x,".link-download",function(){var t,n=$(this),o="banner";if(n.hasClass("drawer")&&(o="drawer"),a.wechat())location.href=a.wechatRedirect();else{if(n.hasClass("private")){o="private";var i=sessionStorage.cid,r=sessionStorage.sid;t=s.openAppVideo(i,r)}else t=s.openAppVideo();w.iframe.empty().html(t),setTimeout(function(){u.download(o),location.href=e},500)}})}function v(){w.share.find(".btn-box").each(function(){if(player){var e,t,n,o,i,a=$(this),s=$(".video-container");if(a.hasClass("fb-share"))e="facebook";else if(a.hasClass("tw-share"))e="twitter";else{if(!a.hasClass("gp-share"))return;e="google-plus"}if(!s)return void console.log("update share url error: no player");t=sessionStorage.title||"",n=sessionStorage.poster||"",o=location.href,i=r.buffUrl("{0}. Watch from here:",t);var l=r.getShareUrl(e,t,n,o,i);a.prop("href",l),a.click(function(){var e;C.search.mid&&(e=C.search.mid),u.share(e)})}})}function m(){c(),Core.Event.trigger("trigerAnimate",w.main),b._BasicView.show(b.viewCls)}this.models={Basic:o,User:i},this.viewCls="view-aside",this._BasicView=n;var g,w,y,b=this,C=Core.localParam(),x=(Core.NativeBridge.isApp(),b._BasicView.tapEvent),k=r.getCookie("userID"),T=r.getCookie("token");m(),Core.Router.subscribe("/video/",v)}var n=R,o=A,i=L,r=O,a=D,s=Y,u=I,l=S;return new t}(X),Z=function(e){function t(){this.views={aside:n}}var n=X;return new t}(Z),Q=function(e){function t(){var e=Core.localParam(),t=e.search.standalone;setTimeout(function(){Core.Router.init(t?"":"/home/")},250)}return window.App=new t,e}(Q)}()}();